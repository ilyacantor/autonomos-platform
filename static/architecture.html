<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutonomOS - Architecture</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            margin-bottom: 40px;
            border: 1px solid rgba(11, 202, 217, 0.3);
        }

        h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #0BCAD9 0%, #6366f1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.2em;
        }

        .section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h2 {
            color: #0BCAD9;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(11, 202, 217, 0.3);
        }

        h3 {
            color: #818cf8;
            font-size: 1.5em;
            margin: 25px 0 15px 0;
        }

        .mermaid {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 8px;
            padding: 20px;
        }

        .feature-card h4 {
            color: #818cf8;
            margin-bottom: 10px;
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .tech-badge {
            background: rgba(11, 202, 217, 0.2);
            border: 1px solid #0BCAD9;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #0BCAD9;
        }

        .legend {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .legend-item {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }

        .legend-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            vertical-align: middle;
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 24px;
            background: rgba(11, 202, 217, 0.2);
            border: 1px solid #0BCAD9;
            border-radius: 8px;
            color: #0BCAD9;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: rgba(11, 202, 217, 0.3);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .section {
                padding: 20px;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>AutonomOS Architecture</h1>
            <p class="subtitle">Multi-Tenant AI Orchestration Platform</p>
        </header>

        <!-- System Overview -->
        <div class="section">
            <h2>System Overview</h2>
            <p>AutonomOS is a production-ready, multi-tenant SaaS platform for AI-driven data orchestration with complete tenant isolation, JWT authentication, and enterprise-grade security.</p>
            
            <div class="mermaid">
graph TB
    subgraph "Client Layer"
        UI[React Frontend<br/>TypeScript + Vite]
    end

    subgraph "API Gateway"
        FastAPI[FastAPI Server<br/>JWT Auth + Multi-Tenant]
        NLP[NLP Gateway<br/>Natural Language Interface]
    end

    subgraph "Core Services"
        AAM[Adaptive API Mesh<br/>Self-Healing Connectors]
        DCL[Data Connection Layer<br/>AI Entity Mapping]
        AOA[Agentic Orchestration<br/>Workflow Management]
    end

    subgraph "Data Layer"
        PostgreSQL[(PostgreSQL<br/>Multi-Tenant DB)]
        Redis[(Redis<br/>Queue + Cache)]
        DuckDB[(DuckDB<br/>Materialized Views)]
    end

    subgraph "AI/ML Services"
        LLM[LLM Provider<br/>Gemini/OpenAI]
        RAG[RAG Knowledge Base<br/>pgvector + BM25]
    end

    UI --> FastAPI
    UI --> NLP
    FastAPI --> AAM
    FastAPI --> DCL
    FastAPI --> AOA
    NLP --> RAG
    NLP --> LLM
    AAM --> PostgreSQL
    DCL --> DuckDB
    DCL --> Redis
    AOA --> Redis
    AAM --> Redis
    RAG --> PostgreSQL

    style UI fill:#818cf8
    style FastAPI fill:#0BCAD9
    style NLP fill:#0BCAD9
    style AAM fill:#10b981
    style DCL fill:#10b981
    style AOA fill:#10b981
    style PostgreSQL fill:#f59e0b
    style Redis fill:#f59e0b
    style DuckDB fill:#f59e0b
    style LLM fill:#ec4899
    style RAG fill:#ec4899
            </div>
        </div>

        <!-- Data Flow Architecture -->
        <div class="section">
            <h2>Unified Data Flow</h2>
            <p>Strangler Fig pattern: Data Sources ‚Üí AAM ‚Üí DCL ‚Üí Agents</p>
            
            <div class="mermaid">
graph LR
    subgraph "Data Sources"
        SF[Salesforce]
        SB[Supabase]
        MG[MongoDB]
        FS[FileSource]
    end

    subgraph "AAM - Adaptive API Mesh"
        CE[Canonical Events<br/>Pydantic Validation]
        SF_C[Schema Fingerprinting]
        AR[Auto-Repair Agent<br/>LLM + RAG]
    end

    subgraph "DCL - Data Connection Layer"
        EM[Entity Mapping<br/>AI-Powered]
        UV[Unified Views<br/>DuckDB]
        GR[Graph Generation]
    end

    subgraph "Agents"
        FO[FinOps Agent]
        RO[RevOps Agent]
        CA[Custom Agents]
    end

    SF --> CE
    SB --> CE
    MG --> CE
    FS --> CE
    CE --> SF_C
    SF_C --> AR
    AR --> EM
    EM --> UV
    UV --> GR
    GR --> FO
    GR --> RO
    GR --> CA

    style SF fill:#3b82f6
    style SB fill:#3b82f6
    style MG fill:#3b82f6
    style FS fill:#3b82f6
    style CE fill:#10b981
    style SF_C fill:#10b981
    style AR fill:#10b981
    style EM fill:#818cf8
    style UV fill:#818cf8
    style GR fill:#818cf8
    style FO fill:#f59e0b
    style RO fill:#f59e0b
    style CA fill:#f59e0b
            </div>
        </div>

        <!-- AAM Architecture -->
        <div class="section">
            <h2>Adaptive API Mesh (AAM)</h2>
            <p>Self-healing data connectivity with drift detection and autonomous repair</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üîå Production Connectors</h4>
                    <p>Salesforce, Supabase, MongoDB, FileSource with unified interface</p>
                </div>
                <div class="feature-card">
                    <h4>üìä Schema Fingerprinting</h4>
                    <p>Automatic drift detection via hash-based schema versioning</p>
                </div>
                <div class="feature-card">
                    <h4>ü§ñ Auto-Repair Agent</h4>
                    <p>LLM-powered field mapping with confidence scoring</p>
                </div>
                <div class="feature-card">
                    <h4>‚úÖ Canonical Events</h4>
                    <p>Pydantic validation + metadata enrichment</p>
                </div>
                <div class="feature-card">
                    <h4>üß† RAG Intelligence</h4>
                    <p>Semantic field matching using embeddings</p>
                </div>
                <div class="feature-card">
                    <h4>üõ°Ô∏è Safe Mode</h4>
                    <p>Default guardrails for auto-onboarding with HITL workflow</p>
                </div>
            </div>

            <div class="mermaid">
sequenceDiagram
    participant DS as Data Source
    participant C as Connector
    participant SF as Schema Fingerprint
    participant AR as Auto-Repair
    participant RAG as RAG Engine
    participant HITL as Human Review

    DS->>C: Data Request
    C->>SF: Validate Schema
    alt Schema Drift Detected
        SF->>AR: Trigger Repair
        AR->>RAG: Semantic Field Matching
        RAG-->>AR: Field Mappings + Confidence
        alt Confidence < 80%
            AR->>HITL: Queue for Review
            HITL-->>AR: Approved Mapping
        end
        AR->>C: Apply Repair
    end
    C->>DS: Canonical Event
            </div>
        </div>

        <!-- DCL Architecture -->
        <div class="section">
            <h2>Data Connection Layer (DCL)</h2>
            <p>AI-driven in-process engine for entity mapping and unified view creation</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üéØ AI Entity Mapping</h4>
                    <p>Automatic relationship discovery via LLM analysis</p>
                </div>
                <div class="feature-card">
                    <h4>üì¶ DuckDB Views</h4>
                    <p>Fast materialized views for cross-source queries</p>
                </div>
                <div class="feature-card">
                    <h4>üîÑ Graph Generation</h4>
                    <p>Dynamic ontology graph with entity relationships</p>
                </div>
                <div class="feature-card">
                    <h4>‚ö° Redis Coordination</h4>
                    <p>Concurrent access control and job queuing</p>
                </div>
                <div class="feature-card">
                    <h4>üî¢ LLM Telemetry</h4>
                    <p>Track cumulative calls and token usage</p>
                </div>
                <div class="feature-card">
                    <h4>‚ôªÔ∏è Idempotent Ops</h4>
                    <p>Safe retry logic for all operations</p>
                </div>
            </div>

            <div class="mermaid">
graph TB
    subgraph "DCL Engine"
        AM[Auto-Mapper<br/>AI Entity Discovery]
        VG[View Generator<br/>DuckDB Materializer]
        GC[Graph Constructor<br/>Ontology Builder]
    end

    subgraph "Data Sources"
        AAM_Data[AAM Canonical Events]
    end

    subgraph "Storage"
        Duck[(DuckDB<br/>In-Memory Views)]
        Redis_Lock[(Redis<br/>Locks + State)]
    end

    subgraph "Output"
        Graph[Knowledge Graph]
        API[Query API]
    end

    AAM_Data --> AM
    AM -->|LLM Analysis| VG
    VG --> Duck
    VG --> GC
    GC --> Redis_Lock
    GC --> Graph
    Duck --> API

    style AM fill:#818cf8
    style VG fill:#10b981
    style GC fill:#0BCAD9
    style Duck fill:#f59e0b
    style Redis_Lock fill:#f59e0b
    style Graph fill:#ec4899
            </div>
        </div>

        <!-- NLP Gateway -->
        <div class="section">
            <h2>NLP Gateway Service</h2>
            <p>Natural language interface with tenant-scoped RAG knowledge base</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üí¨ Multi-Mode Interface</h4>
                    <p>FinOps, RevOps, AAM, DCL, Orchestration modes</p>
                </div>
                <div class="feature-card">
                    <h4>üîç Hybrid Retrieval</h4>
                    <p>BM25 + Vector embeddings with RRF fusion</p>
                </div>
                <div class="feature-card">
                    <h4>üîê PII Redaction</h4>
                    <p>Automatic detection and removal of sensitive data</p>
                </div>
                <div class="feature-card">
                    <h4>üìö Knowledge Base</h4>
                    <p>PostgreSQL + pgvector for semantic search</p>
                </div>
            </div>

            <div class="mermaid">
graph LR
    User[User Query] --> Mode{Select Mode}
    Mode -->|FinOps| KB1[FinOps KB]
    Mode -->|RevOps| KB2[RevOps KB]
    Mode -->|AAM| KB3[AAM KB]
    Mode -->|DCL| KB4[DCL KB]
    
    KB1 --> RAG[RAG Pipeline<br/>BM25 + Vector]
    KB2 --> RAG
    KB3 --> RAG
    KB4 --> RAG
    
    RAG --> PII[PII Redaction]
    PII --> LLM[LLM Response]
    LLM --> Output[Natural Language Answer]

    style Mode fill:#818cf8
    style RAG fill:#10b981
    style PII fill:#f59e0b
    style LLM fill:#ec4899
            </div>
        </div>

        <!-- Security Architecture -->
        <div class="section">
            <h2>Security & Multi-Tenancy</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üîë JWT Authentication</h4>
                    <p>Token-based auth with Argon2 password hashing</p>
                </div>
                <div class="feature-card">
                    <h4>üè¢ Tenant Isolation</h4>
                    <p>UUID-based tenant_id scoping on all queries</p>
                </div>
                <div class="feature-card">
                    <h4>üõ°Ô∏è Zero-Trust Infrastructure</h4>
                    <p>VPC, TLS 1.3, Secrets Management</p>
                </div>
                <div class="feature-card">
                    <h4>üìù Audit Trail</h4>
                    <p>Immutable metadata-only logging</p>
                </div>
                <div class="feature-card">
                    <h4>üë§ HITL Workflow</h4>
                    <p>Human-in-the-Loop for high-risk operations</p>
                </div>
                <div class="feature-card">
                    <h4>üíæ Zero Data Retention</h4>
                    <p>Ephemeral in-memory processing</p>
                </div>
            </div>

            <div class="mermaid">
graph TB
    Request[API Request] --> Auth{JWT Valid?}
    Auth -->|No| Reject[401 Unauthorized]
    Auth -->|Yes| Extract[Extract tenant_id]
    Extract --> Scope[Scope Query to Tenant]
    Scope --> DB[(Multi-Tenant DB)]
    DB --> Audit[Audit Log]
    Audit --> Response[Return Data]

    style Auth fill:#f59e0b
    style Scope fill:#10b981
    style Audit fill:#818cf8
    style Reject fill:#ef4444
            </div>
        </div>

        <!-- Technology Stack -->
        <div class="section">
            <h2>Technology Stack</h2>
            
            <h3>Backend</h3>
            <div class="tech-stack">
                <span class="tech-badge">FastAPI</span>
                <span class="tech-badge">Uvicorn</span>
                <span class="tech-badge">SQLAlchemy</span>
                <span class="tech-badge">Alembic</span>
                <span class="tech-badge">Pydantic</span>
                <span class="tech-badge">Redis Queue (RQ)</span>
                <span class="tech-badge">DuckDB</span>
                <span class="tech-badge">Pandas</span>
            </div>

            <h3>Frontend</h3>
            <div class="tech-stack">
                <span class="tech-badge">React 18</span>
                <span class="tech-badge">TypeScript</span>
                <span class="tech-badge">Vite</span>
                <span class="tech-badge">TailwindCSS</span>
                <span class="tech-badge">D3.js</span>
                <span class="tech-badge">Lucide Icons</span>
            </div>

            <h3>Data & AI</h3>
            <div class="tech-stack">
                <span class="tech-badge">PostgreSQL (Supabase)</span>
                <span class="tech-badge">pgvector</span>
                <span class="tech-badge">Redis (Upstash)</span>
                <span class="tech-badge">Gemini AI</span>
                <span class="tech-badge">OpenAI</span>
            </div>

            <h3>Integration</h3>
            <div class="tech-stack">
                <span class="tech-badge">Salesforce API</span>
                <span class="tech-badge">MongoDB</span>
                <span class="tech-badge">Supabase</span>
                <span class="tech-badge">Slack Webhooks</span>
                <span class="tech-badge">Server-Sent Events</span>
                <span class="tech-badge">WebSockets</span>
            </div>
        </div>

        <!-- Deployment -->
        <div class="section">
            <h2>Deployment & Scalability</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>üöÄ Zero Downtime</h4>
                    <p>Feature flags + Strangler Fig pattern</p>
                </div>
                <div class="feature-card">
                    <h4>üì¶ Build Optimization</h4>
                    <p>Code splitting, CSS optimization, esbuild minification</p>
                </div>
                <div class="feature-card">
                    <h4>üîÑ Auto Migrations</h4>
                    <p>Alembic migrations applied on startup</p>
                </div>
                <div class="feature-card">
                    <h4>‚ö° Redis Queue</h4>
                    <p>Async background job processing with RQ</p>
                </div>
            </div>

            <div class="legend">
                <strong>Legend:</strong><br>
                <div class="legend-item">
                    <span class="legend-color" style="background: #818cf8;"></span>
                    Frontend / UI Layer
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #0BCAD9;"></span>
                    API Gateway / NLP
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #10b981;"></span>
                    Core Services
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #f59e0b;"></span>
                    Data Storage
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background: #ec4899;"></span>
                    AI/ML Services
                </div>
            </div>
        </div>

        <a href="/" class="back-link">‚Üê Back to Dashboard</a>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#818cf8',
                primaryTextColor: '#1e293b',
                primaryBorderColor: '#6366f1',
                lineColor: '#94a3b8',
                secondaryColor: '#0BCAD9',
                tertiaryColor: '#10b981',
                background: '#ffffff',
                mainBkg: '#f1f5f9',
                secondBkg: '#e0f2fe',
                border1: '#cbd5e1',
                border2: '#94a3b8',
                note: '#fef3c7',
                noteBorder: '#f59e0b',
                noteBkg: '#fef3c7'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            }
        });
    </script>
</body>
</html>
