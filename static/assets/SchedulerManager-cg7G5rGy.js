import{r as i,j as e,y as L,o as w,z as D,c as A,I as U,T as P,k as O,s as _,x as q,P as R,F as z,J as B,v as H,Z as V,u as W,A as Q}from"./ui-vendor-DDdGQ_QK.js";import"./react-vendor-BdZgHC1P.js";const b="/api/v1/scheduler";async function X(){const t=await fetch(`${b}/jobs`);if(!t.ok)throw new Error("Failed to fetch jobs");return(await t.json()).jobs||[]}async function Z(t){return(await fetch(`${b}/cron/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({expression:t})})).json()}async function G(t){const s=await fetch(`${b}/jobs`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.detail||"Failed to create job")}return s.json()}async function Y(t){if(!(await fetch(`${b}/jobs/${t}/pause`,{method:"POST"})).ok)throw new Error("Failed to pause job")}async function K(t){if(!(await fetch(`${b}/jobs/${t}/resume`,{method:"POST"})).ok)throw new Error("Failed to resume job")}async function ee(t){if(!(await fetch(`${b}/jobs/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete job")}async function te(t){const s=await fetch(`${b}/jobs/${t}/trigger`,{method:"POST"});if(!s.ok)throw new Error("Failed to trigger job");return(await s.json()).execution_id}function se({status:t,size:s="sm"}){const n={optimal:{bg:"bg-emerald-500/20",text:"text-emerald-400",glow:"shadow-emerald-500/20"},active:{bg:"bg-emerald-500/20",text:"text-emerald-400",glow:"shadow-emerald-500/20"},warning:{bg:"bg-yellow-500/20",text:"text-yellow-400",glow:"shadow-yellow-500/20"},paused:{bg:"bg-yellow-500/20",text:"text-yellow-400",glow:"shadow-yellow-500/20"},critical:{bg:"bg-red-500/20",text:"text-red-400",glow:"shadow-red-500/20"},failed:{bg:"bg-red-500/20",text:"text-red-400",glow:"shadow-red-500/20"},expired:{bg:"bg-red-500/20",text:"text-red-400",glow:"shadow-red-500/20"},disabled:{bg:"bg-gray-500/20",text:"text-gray-400",glow:""},pending:{bg:"bg-blue-500/20",text:"text-blue-400",glow:"shadow-blue-500/20"},running:{bg:"bg-purple-500/20",text:"text-purple-400",glow:"shadow-purple-500/20"},completed:{bg:"bg-emerald-500/20",text:"text-emerald-400",glow:"shadow-emerald-500/20"},timeout:{bg:"bg-orange-500/20",text:"text-orange-400",glow:"shadow-orange-500/20"}},{bg:c,text:m,glow:d}=n[t]||n.disabled,x=s==="md"?"px-3 py-1 text-sm":"px-2 py-0.5 text-xs";return e.jsx("span",{className:`${c} ${m} ${d} ${x} rounded font-medium shadow-sm`,children:t})}function ae({value:t,target:s=90,color:n="cyan"}){const c=()=>t>=s?"bg-emerald-500":t>=s-15?"bg-yellow-500":"bg-red-500";return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"h-1.5 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${c()} rounded-full transition-all duration-500`,style:{width:`${Math.min(100,t)}%`}})}),e.jsx("div",{className:"flex justify-between mt-1",children:e.jsxs("span",{className:"text-xs text-gray-500",children:["Target: ",s,"%"]})})]})}function v({title:t,description:s,value:n,unit:c="%",target:m=90,trend:d,status:x}){const g=d==="up"?P:d==="down"?O:_,r=d==="up"?"text-emerald-400":d==="down"?"text-red-400":"text-gray-400";return e.jsxs("div",{className:"bg-gray-800/50 rounded-xl border border-gray-700/50 p-5 hover:border-gray-600 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-medium",children:t}),e.jsxs("p",{className:"text-gray-400 text-xs mt-0.5 flex items-center gap-1",children:[s,e.jsx(U,{className:"w-3 h-3 text-gray-500"})]})]}),e.jsx(se,{status:x,size:"md"})]}),e.jsxs("div",{className:"flex items-end gap-2 mb-4",children:[e.jsx("span",{className:`text-4xl font-bold ${x==="optimal"?"text-emerald-400":x==="warning"?"text-yellow-400":"text-red-400"}`,children:n}),e.jsx("span",{className:"text-xl text-gray-400 mb-1",children:c}),d&&e.jsx(g,{className:`w-5 h-5 ${r} ml-2 mb-1`})]}),e.jsx(ae,{value:n,target:m})]})}function N({label:t,description:s,value:n,trend:c,color:m="cyan"}){const d=c==="up"?P:c==="down"?O:_,x={cyan:"text-cyan-400",emerald:"text-emerald-400",purple:"text-purple-400",yellow:"text-yellow-400",red:"text-red-400"};return e.jsx("div",{className:"bg-gray-800/30 rounded-xl border border-gray-700/50 p-6 hover:bg-gray-800/50 transition-all",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-white font-medium flex items-center gap-2",children:[t,c&&e.jsx(d,{className:`w-4 h-4 ${c==="up"?"text-emerald-400":c==="down"?"text-red-400":"text-gray-400"}`})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-0.5",children:s})]}),e.jsx("span",{className:`text-3xl font-bold ${x[m]}`,children:n})]})})}function re({job:t,onPause:s,onResume:n,onDelete:c,onTrigger:m}){const d=Math.floor(Math.random()*100)+50,x=Math.floor(Math.random()*40)+10,g=Math.floor(Math.random()*300)+200;return e.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/30 transition-colors",children:[e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-white font-medium",children:t.name}),e.jsx(q,{className:"w-3.5 h-3.5 text-gray-500 hover:text-cyan-400 cursor-pointer"})]})}),e.jsx("td",{className:"py-4 px-4",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:`w-2 h-2 rounded-full ${t.status==="active"?"bg-emerald-400":t.status==="paused"?"bg-yellow-400":"bg-gray-400"}`})})}),e.jsx("td",{className:"py-4 px-4 text-gray-300",children:d}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("span",{className:`${x>30?"text-yellow-400":"text-cyan-400"}`,children:[x,"%"]})}),e.jsxs("td",{className:"py-4 px-4 text-gray-300",children:[g," MB"]}),e.jsx("td",{className:"py-4 px-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:m,className:"p-1.5 text-cyan-400 hover:bg-cyan-500/20 rounded transition-colors",title:"Run Now",children:e.jsx(R,{className:"w-4 h-4"})}),t.status==="active"?e.jsx("button",{onClick:s,className:"p-1.5 text-yellow-400 hover:bg-yellow-500/20 rounded transition-colors",title:"Pause",children:e.jsx(z,{className:"w-4 h-4"})}):t.status==="paused"?e.jsx("button",{onClick:n,className:"p-1.5 text-emerald-400 hover:bg-emerald-500/20 rounded transition-colors",title:"Resume",children:e.jsx(R,{className:"w-4 h-4"})}):null,e.jsx("button",{onClick:c,className:"p-1.5 text-red-400 hover:bg-red-500/20 rounded transition-colors",title:"Delete",children:e.jsx(B,{className:"w-4 h-4"})})]})})]})}function ne({onClose:t,onCreate:s}){const[n,c]=i.useState(""),[m,d]=i.useState(""),[x,g]=i.useState("default"),[r,h]=i.useState("cron"),[p,S]=i.useState("0 9 * * *"),[j,C]=i.useState(3600),[y,a]=i.useState(""),[o,u]=i.useState(null),[I,T]=i.useState(!1),[k,J]=i.useState(!1),[$,E]=i.useState(null);i.useEffect(()=>{if(r==="cron"&&p){T(!0);const l=setTimeout(()=>{Z(p).then(u).catch(()=>u({valid:!1,error:"Validation failed"})).finally(()=>T(!1))},500);return()=>clearTimeout(l)}},[p,r]);const M=async l=>{l.preventDefault(),E(null),J(!0);try{const f={name:n,description:m||void 0,agent_id:x,input_template:y||void 0,trigger:{trigger_type:r,cron_expression:r==="cron"?p:void 0,interval_seconds:r==="interval"?j:void 0},timeout_seconds:300,max_retries:3,allow_concurrent:!1};await G(f),s(f)}catch(f){E(f.message)}finally{J(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl border border-gray-700 w-full max-w-xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"p-5 border-b border-gray-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Create Scheduled Job"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Configure automated agent execution"})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(H,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:M,className:"p-5 space-y-5",children:[$&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-xl text-red-400 text-sm",children:$}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Job Name"}),e.jsx("input",{type:"text",value:n,onChange:l=>c(l.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all",placeholder:"e.g., Daily Revenue Report"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Description"}),e.jsx("input",{type:"text",value:m,onChange:l=>d(l.target.value),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all",placeholder:"What does this job do?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Agent"}),e.jsxs("select",{value:x,onChange:l=>g(l.target.value),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all",children:[e.jsx("option",{value:"default",children:"Default Agent"}),e.jsx("option",{value:"revops-agent",children:"RevOps Agent"}),e.jsx("option",{value:"finops-agent",children:"FinOps Agent"}),e.jsx("option",{value:"sales-forecasting",children:"Sales Forecasting"}),e.jsx("option",{value:"churn-predictor",children:"Churn Predictor"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Trigger Type"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{id:"cron",label:"Cron",icon:A},{id:"interval",label:"Interval",icon:w},{id:"webhook",label:"Webhook",icon:V},{id:"event",label:"Event",icon:_}].map(({id:l,label:f,icon:F})=>e.jsxs("button",{type:"button",onClick:()=>h(l),className:`flex flex-col items-center gap-2 p-3 rounded-xl border transition-all ${r===l?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-gray-800 border-gray-700 text-gray-400 hover:border-gray-600"}`,children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:f})]},l))})]}),r==="cron"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Cron Expression"}),e.jsx("input",{type:"text",value:p,onChange:l=>S(l.target.value),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl text-white font-mono focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all",placeholder:"0 9 * * *"}),I?e.jsxs("p",{className:"text-xs text-gray-400 mt-2 flex items-center gap-2",children:[e.jsx(w,{className:"w-3 h-3 animate-spin"}),"Validating..."]}):o?e.jsx("div",{className:"mt-2 p-3 rounded-lg bg-gray-800/50",children:o.valid?e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"text-emerald-400 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),o.description]}),o.next_runs&&e.jsxs("p",{className:"text-gray-400 text-xs mt-2",children:["Next run: ",new Date(o.next_runs[0]).toLocaleString()]})]}):e.jsxs("p",{className:"text-sm text-red-400 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),o.error]})}):null]}),r==="interval"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Interval (seconds)"}),e.jsx("input",{type:"number",value:j,onChange:l=>C(Number(l.target.value)),min:60,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-2",children:["Runs every ",Math.floor(j/60)," minutes"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Input Template (optional)"}),e.jsx("textarea",{value:y,onChange:l=>a(l.target.value),rows:3,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl text-white font-mono text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all resize-none",placeholder:'{"prompt": "Generate report for {{date}}"}'})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-xl transition-colors font-medium",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:k||r==="cron"&&!o?.valid,className:"flex-1 px-4 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 disabled:from-gray-700 disabled:to-gray-700 disabled:cursor-not-allowed text-white rounded-xl transition-all font-medium shadow-lg shadow-cyan-500/20 disabled:shadow-none",children:k?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 animate-spin"}),"Creating..."]}):"Create Job"})]})]})]})})}function ie(){const[t,s]=i.useState([]),[n,c]=i.useState(!0),[m,d]=i.useState(null),[x,g]=i.useState(!1),[r]=i.useState({successRate:94,avgLatency:127,throughput:342,queueDepth:12,activeJobs:8,totalJobs:12,failedToday:3,executionsToday:847}),h=i.useCallback(async()=>{try{c(!0),d(null);const a=await X();s(a)}catch(a){d(a.message),s([{job_id:"1",tenant_id:"1",name:"Revenue Aggregation",description:"Daily revenue rollup from all sources",agent_id:"revops-agent",trigger:{trigger_type:"cron",cron_expression:"0 6 * * *"},status:"active",timeout_seconds:300,max_retries:3,allow_concurrent:!1,run_count:342,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{job_id:"2",tenant_id:"1",name:"Churn Analysis",description:"Weekly churn prediction model refresh",agent_id:"churn-predictor",trigger:{trigger_type:"cron",cron_expression:"0 0 * * 0"},status:"active",timeout_seconds:600,max_retries:2,allow_concurrent:!1,run_count:52,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{job_id:"3",tenant_id:"1",name:"Lead Scoring Update",description:"Hourly lead score recalculation",agent_id:"sales-forecasting",trigger:{trigger_type:"interval",interval_seconds:3600},status:"paused",timeout_seconds:180,max_retries:3,allow_concurrent:!1,run_count:1847,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}])}finally{c(!1)}},[]);i.useEffect(()=>{h()},[h]);const p=async a=>{try{await Y(a),h()}catch(o){console.error("Pause failed:",o),s(t.map(u=>u.job_id===a?{...u,status:"paused"}:u))}},S=async a=>{try{await K(a),h()}catch(o){console.error("Resume failed:",o),s(t.map(u=>u.job_id===a?{...u,status:"active"}:u))}},j=async a=>{if(confirm("Are you sure you want to delete this job?"))try{await ee(a),h()}catch(o){console.error("Delete failed:",o),s(t.filter(u=>u.job_id!==a))}},C=async a=>{try{const o=await te(a);alert(`Job triggered! Execution ID: ${o}`),h()}catch{alert("Job triggered (demo mode)")}},y=(a,o)=>a>=o.optimal?"optimal":a>=o.warning?"warning":"critical";return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-cyan-500/20",children:e.jsx(L,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Scheduler Service"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Automated job orchestration and execution monitoring"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:h,className:"p-2.5 text-gray-400 hover:text-white hover:bg-gray-800 rounded-xl transition-colors",title:"Refresh",children:e.jsx(w,{className:`w-5 h-5 ${n?"animate-spin":""}`})}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white rounded-xl transition-all font-medium shadow-lg shadow-cyan-500/20",children:[e.jsx(D,{className:"w-4 h-4"}),"New Job"]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Scheduler Functions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(v,{title:"Execution",description:"Job Success Rate",value:r.successRate,target:90,trend:"up",status:y(r.successRate,{optimal:90,warning:75})}),e.jsx(v,{title:"Queue",description:"Queue Health",value:100-r.queueDepth/50*100,target:85,trend:"stable",status:y(100-r.queueDepth/50*100,{optimal:80,warning:60})}),e.jsx(v,{title:"Reliability",description:"Uptime Score",value:99.2,target:99,trend:"up",status:"optimal"}),e.jsx(v,{title:"Throughput",description:"Jobs/Hour Capacity",value:87,target:80,trend:"up",status:y(87,{optimal:80,warning:60})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(N,{label:"Active Jobs",description:"Currently scheduled",value:`${r.activeJobs}/${r.totalJobs}`,trend:"stable",color:"emerald"}),e.jsx(N,{label:"Executions Today",description:"Completed runs",value:r.executionsToday.toString(),trend:"up",color:"cyan"}),e.jsx(N,{label:"Avg Latency",description:"P95 execution time",value:`${r.avgLatency}ms`,trend:"down",color:"purple"}),e.jsx(N,{label:"Failed Today",description:"Requires attention",value:r.failedToday.toString(),trend:"down",color:r.failedToday>5?"red":"yellow"})]}),e.jsxs("div",{className:"bg-gray-800/30 rounded-2xl border border-gray-700/50 overflow-hidden",children:[e.jsx("div",{className:"p-5 border-b border-gray-700/50",children:e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Active Job Performance"})}),n&&t.length===0?e.jsxs("div",{className:"flex items-center justify-center py-16 text-gray-400",children:[e.jsx(w,{className:"w-6 h-6 animate-spin mr-3"}),"Loading scheduled jobs..."]}):t.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(A,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No Scheduled Jobs"}),e.jsx("p",{className:"text-gray-500 text-sm mb-6",children:"Create your first job to start automating agent executions"}),e.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-xl font-medium shadow-lg shadow-cyan-500/20",children:[e.jsx(D,{className:"w-4 h-4"}),"Create Job"]})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-700/50",children:[e.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"JOB"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"STATUS"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"EXEC/HR"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"CPU"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"MEMORY"}),e.jsx("th",{className:"text-left py-3 px-4 text-gray-400 font-medium text-sm",children:"ACTIONS"})]})}),e.jsx("tbody",{children:t.map(a=>e.jsx(re,{job:a,onPause:()=>p(a.job_id),onResume:()=>S(a.job_id),onDelete:()=>j(a.job_id),onTrigger:()=>C(a.job_id)},a.job_id))})]}),e.jsx("div",{className:"p-4 border-t border-gray-700/50 text-center text-xs text-gray-500",children:"Each % value represents real-time operational efficiency of the scheduler function vs its target SLO."})]}),x&&e.jsx(ne,{onClose:()=>g(!1),onCreate:()=>{g(!1),h()}})]})}export{ie as default};
