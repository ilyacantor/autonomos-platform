import{r as x,j as e,c as T,Z as V,p as G,o as O,x as Z,n as F,f as B,y as I,z as X,i as ee,F as K,I as Q,J as L,t as E,u as P,b as te,K as se,P as J,m as U,w as ae,O as Y,Q as z,V as W,Y as re,_ as ne,$ as le,a0 as ie,a1 as oe}from"./ui-vendor-D3UCEcOR.js";import ce from"./SchedulerManager-BPIVpEOj.js";import"./react-vendor-BdZgHC1P.js";function de({agentId:b="default",agentName:j="AOS Agent",onRunComplete:r}){const[g,c]=x.useState([]),[n,v]=x.useState(""),[k,N]=x.useState(!1),[h,_]=x.useState(null),[w,A]=x.useState(!1),[C,R]=x.useState(new Set),D=x.useRef(null),$=x.useRef(null);x.useEffect(()=>{D.current?.scrollIntoView({behavior:"smooth"})},[g]);const q=x.useCallback(t=>{const y=localStorage.getItem("token"),l=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/api/v1/agents/runs/${t}/stream`,o=new WebSocket(l);return $.current=o,o.onopen=()=>{A(!0),y&&o.send(JSON.stringify({type:"auth",token:y}))},o.onmessage=f=>{const S=JSON.parse(f.data);d(S)},o.onclose=()=>{A(!1)},o.onerror=f=>{console.error("WebSocket error:",f),A(!1)},o},[]),d=x.useCallback(t=>{const{event:y,data:l}=t;switch(y){case"run_started":_(o=>({...o,status:"running"}));break;case"step_started":break;case"tool_call_started":c(o=>{const f=o[o.length-1];if(f?.role==="assistant"){const S={id:l.tool_call_id||crypto.randomUUID(),tool_name:l.tool_name,tool_server:l.tool_server,arguments:l.arguments,status:"running"};return[...o.slice(0,-1),{...f,tool_calls:[...f.tool_calls||[],S]}]}return o});break;case"tool_call_completed":c(o=>{const f=o[o.length-1];if(f?.role==="assistant"&&f.tool_calls){const S=f.tool_calls.map(M=>M.tool_name===l.tool_name?{...M,status:"completed",result:l.result,duration_ms:l.duration_ms}:M);return[...o.slice(0,-1),{...f,tool_calls:S}]}return o});break;case"approval_required":_(o=>({...o,status:"waiting_approval"})),c(o=>[...o,{id:crypto.randomUUID(),role:"system",content:`Approval required for: ${l.action_type}`,timestamp:new Date,approval_request:{approval_id:l.approval_id,action_type:l.action_type,action_details:l.action_details,expires_at:l.expires_at}}]);break;case"run_completed":_(o=>({...o,status:"completed",completed_at:new Date,total_tokens_input:l.tokens_input,total_tokens_output:l.tokens_output,total_cost_usd:l.cost_usd,steps_executed:l.steps_executed})),N(!1),l.output&&c(o=>[...o,{id:crypto.randomUUID(),role:"assistant",content:l.output,timestamp:new Date,tokens_input:l.tokens_input,tokens_output:l.tokens_output,cost_usd:l.cost_usd}]),r&&h&&r({...h,status:"completed"});break;case"run_failed":_(o=>({...o,status:"failed",completed_at:new Date})),N(!1),c(o=>[...o,{id:crypto.randomUUID(),role:"system",content:`Error: ${l.error}`,timestamp:new Date}]);break}},[h,r]),a=async t=>{if(t.preventDefault(),!n.trim()||k)return;const y={id:crypto.randomUUID(),role:"user",content:n.trim(),timestamp:new Date};c(l=>[...l,y]),v(""),N(!0);try{const l=localStorage.getItem("token"),o=await fetch(`/api/v1/agents/${b}/runs`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l?`Bearer ${l}`:""},body:JSON.stringify({input:y.content,stream:!0})});if(!o.ok)throw new Error("Failed to start agent run");const S=(await o.json()).run_id;_({run_id:S,agent_id:b,agent_name:j,status:"pending",started_at:new Date,messages:[y],total_tokens_input:0,total_tokens_output:0,total_cost_usd:0,steps_executed:0}),c(M=>[...M,{id:crypto.randomUUID(),role:"assistant",content:"",timestamp:new Date}]),q(S)}catch(l){N(!1),c(o=>[...o,{id:crypto.randomUUID(),role:"system",content:`Error: ${l instanceof Error?l.message:"Unknown error"}`,timestamp:new Date}])}},m=async(t,y,l)=>{try{const o=localStorage.getItem("token");await fetch(`/api/v1/agents/approvals/${t}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:o?`Bearer ${o}`:""},body:JSON.stringify({approved:y,notes:l})}),c(f=>f.map(S=>S.approval_request?.approval_id===t?{...S,content:`${S.content} - ${y?"APPROVED":"REJECTED"}`,approval_request:void 0}:S)),y&&_(f=>f?{...f,status:"running"}:null)}catch(o){console.error("Approval error:",o)}},p=t=>{R(y=>{const l=new Set(y);return l.has(t)?l.delete(t):l.add(t),l})},s=t=>{navigator.clipboard.writeText(t)},i=t=>{const y=C.has(t.id);return e.jsxs("div",{className:"bg-gray-900/50 rounded-lg border border-gray-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>p(t.id),className:"w-full flex items-center gap-3 px-3 py-2 hover:bg-gray-800/50 transition-colors",children:[y?e.jsx(K,{className:"w-4 h-4 text-gray-400"}):e.jsx(Q,{className:"w-4 h-4 text-gray-400"}),e.jsx(L,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:t.tool_name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",t.tool_server,")"]}),e.jsx("div",{className:"flex-1"}),t.status==="running"&&e.jsx(B,{className:"w-4 h-4 text-yellow-400 animate-spin"}),t.status==="completed"&&e.jsx(E,{className:"w-4 h-4 text-green-400"}),t.status==="failed"&&e.jsx(P,{className:"w-4 h-4 text-red-400"}),t.duration_ms!==void 0&&e.jsxs("span",{className:"text-xs text-gray-500",children:[t.duration_ms,"ms"]})]}),y&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-700 space-y-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Arguments"}),e.jsx("pre",{className:"text-xs bg-gray-900 rounded p-2 overflow-x-auto text-gray-300",children:JSON.stringify(t.arguments,null,2)})]}),t.result!==void 0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Result"}),e.jsx("pre",{className:"text-xs bg-gray-900 rounded p-2 overflow-x-auto text-gray-300 max-h-40",children:typeof t.result=="string"?t.result:JSON.stringify(t.result,null,2)})]})]})]},t.id)},u=t=>e.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-500/50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(F,{className:"w-5 h-5 text-yellow-400"}),e.jsx("span",{className:"font-medium text-yellow-400",children:"Approval Required"})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("span",{className:"text-gray-400",children:"Action:"})," ",t.action_type]}),e.jsx("div",{className:"text-xs bg-gray-900/50 rounded p-2 text-gray-400",children:JSON.stringify(t.action_details,null,2)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Expires: ",new Date(t.expires_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>m(t.approval_id,!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(E,{className:"w-4 h-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>m(t.approval_id,!1),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(P,{className:"w-4 h-4"}),"Reject"]})]})]});return e.jsxs("div",{className:"flex flex-col h-full bg-gray-800 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-700 bg-gradient-to-r from-purple-900/50 to-blue-900/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:j}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:`px-2 py-0.5 rounded ${w?"bg-green-500/20 text-green-400":"bg-gray-700 text-gray-400"}`,children:w?"Connected":"Disconnected"}),h&&e.jsx("span",{className:`px-2 py-0.5 rounded ${h.status==="running"?"bg-yellow-500/20 text-yellow-400":h.status==="completed"?"bg-green-500/20 text-green-400":h.status==="failed"?"bg-red-500/20 text-red-400":"bg-gray-700 text-gray-400"}`,children:h.status})]})]})]}),h&&e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),e.jsxs("span",{children:[h.total_tokens_input+h.total_tokens_output," tokens"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsxs("span",{children:["$",h.total_cost_usd.toFixed(4)]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsxs("span",{children:[h.steps_executed," steps"]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[g.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx(T,{className:"w-16 h-16 text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"Start a conversation"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-md",children:"Ask questions about your data, request analyses, or trigger automated workflows. The agent will use available tools to help you."})]}):g.map(t=>e.jsxs("div",{className:`flex gap-3 ${t.role==="user"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${t.role==="user"?"bg-blue-600":t.role==="system"?"bg-yellow-600":"bg-purple-600"}`,children:t.role==="user"?e.jsx(Z,{className:"w-4 h-4 text-white"}):t.role==="system"?e.jsx(F,{className:"w-4 h-4 text-white"}):e.jsx(T,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:`flex-1 max-w-[80%] ${t.role==="user"?"text-right":""}`,children:[e.jsxs("div",{className:`inline-block rounded-lg px-4 py-3 ${t.role==="user"?"bg-blue-600 text-white":t.role==="system"?"bg-yellow-900/30 border border-yellow-500/30 text-yellow-200":"bg-gray-700 text-gray-200"}`,children:[t.content&&e.jsx("div",{className:"whitespace-pre-wrap text-sm",children:t.content}),t.tool_calls&&t.tool_calls.length>0&&e.jsx("div",{className:"mt-3 space-y-2",children:t.tool_calls.map(i)}),t.approval_request&&u(t.approval_request),t.role==="assistant"&&!t.content&&!t.tool_calls?.length&&k&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 animate-spin text-purple-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Thinking..."})]})]}),e.jsxs("div",{className:`flex items-center gap-2 mt-1 text-xs text-gray-500 ${t.role==="user"?"justify-end":""}`,children:[e.jsx(I,{className:"w-3 h-3"}),e.jsx("span",{children:t.timestamp.toLocaleTimeString()}),t.role==="assistant"&&t.cost_usd!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-600",children:"|"}),e.jsxs("span",{children:["$",t.cost_usd.toFixed(4)]})]}),t.role!=="user"&&t.content&&e.jsx("button",{onClick:()=>s(t.content),className:"p-1 hover:bg-gray-700 rounded transition-colors",title:"Copy to clipboard",children:e.jsx(X,{className:"w-3 h-3"})})]})]})]},t.id)),e.jsx("div",{ref:D})]}),e.jsx("form",{onSubmit:a,className:"p-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"text",value:n,onChange:t=>v(t.target.value),placeholder:"Ask the agent anything...",className:"flex-1 px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:k}),e.jsx("button",{type:"submit",disabled:k||!n.trim(),className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700 disabled:cursor-not-allowed rounded-lg text-white font-medium transition-colors flex items-center gap-2",children:k?e.jsx(B,{className:"w-5 h-5 animate-spin"}):e.jsx(ee,{className:"w-5 h-5"})})]})})]})}function xe({agentId:b,onSelectRun:j,limit:r=20}){const[g,c]=x.useState([]),[n,v]=x.useState(!0),[k,N]=x.useState(new Set),[h,_]=x.useState(""),[w,A]=x.useState("all");x.useEffect(()=>{C()},[b,w]);const C=async()=>{v(!0);try{const a=localStorage.getItem("token"),m=new URLSearchParams({limit:r.toString(),...b&&{agent_id:b},...w!=="all"&&{status:w}}),p=await fetch(`/api/v1/agents/runs?${m}`,{headers:{Authorization:a?`Bearer ${a}`:""}});if(p.ok){const s=await p.json();c(s.runs||[])}}catch(a){console.error("Failed to fetch runs:",a),c(R())}finally{v(!1)}},R=()=>[{run_id:"run-001",agent_id:"agent-default",agent_name:"AOS Agent",input:"What is the total revenue for Q4 2025?",output:"Based on the data from Snowflake, the total revenue for Q4 2025 was $4.2M...",status:"completed",started_at:new Date(Date.now()-3e5).toISOString(),completed_at:new Date(Date.now()-295e3).toISOString(),tokens_input:1245,tokens_output:892,cost_usd:.0156,steps:[{step_number:1,tool_name:"dcl_query",tool_server:"dcl",status:"completed",duration_ms:1200},{step_number:2,tool_name:"dcl_get_schema",tool_server:"dcl",status:"completed",duration_ms:450}]},{run_id:"run-002",agent_id:"agent-default",agent_name:"AOS Agent",input:"Create a new Salesforce connection to production",status:"waiting_approval",started_at:new Date(Date.now()-6e5).toISOString(),tokens_input:856,tokens_output:234,cost_usd:.0089,steps:[{step_number:1,tool_name:"aam_validate_credentials",tool_server:"aam",status:"completed",duration_ms:2300}]},{run_id:"run-003",agent_id:"agent-default",agent_name:"AOS Agent",input:"Show me the data lineage for the customers table",output:"The customers table has the following lineage...",status:"completed",started_at:new Date(Date.now()-18e5).toISOString(),completed_at:new Date(Date.now()-1795e3).toISOString(),tokens_input:2100,tokens_output:1567,cost_usd:.0298,steps:[{step_number:1,tool_name:"aod_get_lineage",tool_server:"aod",status:"completed",duration_ms:890},{step_number:2,tool_name:"aod_get_related_assets",tool_server:"aod",status:"completed",duration_ms:650}]},{run_id:"run-004",agent_id:"agent-default",agent_name:"AOS Agent",input:"Run sync for all Snowflake connectors",status:"failed",started_at:new Date(Date.now()-36e5).toISOString(),completed_at:new Date(Date.now()-3595e3).toISOString(),tokens_input:567,tokens_output:123,cost_usd:.0045,steps:[{step_number:1,tool_name:"aam_trigger_sync",tool_server:"aam",status:"failed",duration_ms:4500}],error:"Connection timeout: Snowflake cluster not responding"}],D=a=>{N(m=>{const p=new Set(m);return p.has(a)?p.delete(a):p.add(a),p})},$=g.filter(a=>{if(!h)return!0;const m=h.toLowerCase();return a.input.toLowerCase().includes(m)||a.output?.toLowerCase().includes(m)||a.agent_name.toLowerCase().includes(m)}),q=a=>{switch(a){case"completed":return{icon:E,color:"text-green-400",bg:"bg-green-500/20"};case"failed":return{icon:P,color:"text-red-400",bg:"bg-red-500/20"};case"running":return{icon:O,color:"text-yellow-400",bg:"bg-yellow-500/20"};case"waiting_approval":return{icon:F,color:"text-orange-400",bg:"bg-orange-500/20"};default:return{icon:I,color:"text-gray-400",bg:"bg-gray-500/20"}}},d=(a,m)=>{if(!m)return"In progress...";const p=new Date(m).getTime()-new Date(a).getTime();return p<1e3?`${p}ms`:p<6e4?`${(p/1e3).toFixed(1)}s`:`${Math.floor(p/6e4)}m ${Math.floor(p%6e4/1e3)}s`};return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Run History"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",$.length," runs)"]})]}),e.jsx("button",{onClick:C,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Refresh",children:e.jsx(O,{className:`w-4 h-4 text-gray-400 ${n?"animate-spin":""}`})})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-700 flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500"}),e.jsx("input",{type:"text",value:h,onChange:a=>_(a.target.value),placeholder:"Search runs...",className:"w-full pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-500"}),e.jsxs("select",{value:w,onChange:a=>A(a.target.value),className:"bg-gray-700 border border-gray-600 rounded-lg text-white text-sm px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"running",children:"Running"}),e.jsx("option",{value:"waiting_approval",children:"Waiting Approval"})]})]})]}),e.jsx("div",{className:"divide-y divide-gray-700",children:n?e.jsxs("div",{className:"px-4 py-8 text-center",children:[e.jsx(O,{className:"w-8 h-8 text-gray-500 animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Loading runs..."})]}):$.length===0?e.jsxs("div",{className:"px-4 py-8 text-center",children:[e.jsx(T,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No runs found"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Start a conversation to create your first run"})]}):$.map(a=>{const m=k.has(a.run_id),p=q(a.status),s=p.icon;return e.jsxs("div",{className:"hover:bg-gray-750",children:[e.jsx("div",{className:"px-4 py-3 cursor-pointer",onClick:()=>D(a.run_id),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{className:"mt-1 text-gray-500 hover:text-gray-300",children:m?e.jsx(K,{className:"w-4 h-4"}):e.jsx(Q,{className:"w-4 h-4"})}),e.jsx("div",{className:`p-2 rounded-lg ${p.bg}`,children:e.jsx(s,{className:`w-4 h-4 ${p.color}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-sm font-medium text-white truncate",children:a.input.length>60?`${a.input.slice(0,60)}...`:a.input})}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"}),a.agent_name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"}),d(a.started_at,a.completed_at)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),a.tokens_input+a.tokens_output," tokens"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),"$",a.cost_usd.toFixed(4)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),a.steps.length," steps"]})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:new Date(a.started_at).toLocaleString()})]})}),m&&e.jsx("div",{className:"px-4 pb-4 ml-12",children:e.jsxs("div",{className:"bg-gray-900/50 rounded-lg border border-gray-700 p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Input"}),e.jsx("div",{className:"text-sm text-gray-300 bg-gray-800 rounded p-2",children:a.input})]}),a.output&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Output"}),e.jsx("div",{className:"text-sm text-gray-300 bg-gray-800 rounded p-2 max-h-40 overflow-y-auto",children:a.output})]}),a.error&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-red-400 mb-1",children:"Error"}),e.jsx("div",{className:"text-sm text-red-300 bg-red-900/30 border border-red-500/30 rounded p-2",children:a.error})]}),a.steps.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Steps"}),e.jsx("div",{className:"space-y-2",children:a.steps.map(i=>e.jsxs("div",{className:"flex items-center gap-3 text-sm bg-gray-800 rounded p-2",children:[e.jsxs("span",{className:"text-gray-500",children:["#",i.step_number]}),e.jsx(L,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-white",children:i.tool_name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",i.tool_server,")"]}),e.jsx("div",{className:"flex-1"}),i.status==="completed"?e.jsx(E,{className:"w-4 h-4 text-green-400"}):e.jsx(P,{className:"w-4 h-4 text-red-400"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[i.duration_ms,"ms"]})]},i.step_number))})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t border-gray-700",children:[j&&e.jsxs("button",{onClick:()=>j(a),className:"flex items-center gap-2 px-3 py-1.5 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(J,{className:"w-4 h-4"}),"Continue"]}),e.jsx("button",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded-lg transition-colors",children:"View Details"})]})]})})]},a.run_id)})})]})}function me({onApprovalComplete:b}){const[j,r]=x.useState([]),[g,c]=x.useState(!0),[n,v]=x.useState(null),[k,N]=x.useState(""),[h,_]=x.useState(!1);x.useEffect(()=>{w();const d=setInterval(w,3e4);return()=>clearInterval(d)},[]);const w=async()=>{c(!0);try{const d=localStorage.getItem("token"),a=await fetch("/api/v1/agents/approvals?status=pending",{headers:{Authorization:d?`Bearer ${d}`:""}});if(a.ok){const m=await a.json();r(m.approvals||[])}}catch(d){console.error("Failed to fetch approvals:",d),r(A())}finally{c(!1)}},A=()=>[{approval_id:"apr-001",run_id:"run-002",agent_id:"agent-default",agent_name:"AOS Agent",action_type:"aam_create_connection",action_details:{connection_name:"salesforce-prod",connection_type:"salesforce",environment:"production",oauth_scope:"full",sync_schedule:"0 * * * *"},risk_level:"high",created_at:new Date(Date.now()-6e5).toISOString(),expires_at:new Date(Date.now()+3e6).toISOString(),context:{user_query:"Create a new Salesforce connection to production",step_number:2,previous_actions:["aam_validate_credentials"]}},{approval_id:"apr-002",run_id:"run-005",agent_id:"agent-default",agent_name:"AOS Agent",action_type:"aam_repair_drift",action_details:{connection_id:"conn-snowflake-01",drift_type:"schema_change",changes:[{field:"revenue",old_type:"integer",new_type:"decimal"},{field:"customer_id",action:"added"}],auto_apply:!0},risk_level:"medium",created_at:new Date(Date.now()-3e5).toISOString(),expires_at:new Date(Date.now()+36e5).toISOString(),context:{user_query:"Fix the schema drift on Snowflake connector",step_number:1,previous_actions:[]}},{approval_id:"apr-003",run_id:"run-006",agent_id:"agent-default",agent_name:"AOS Agent",action_type:"dcl_write_query",action_details:{table:"analytics.customer_segments",operation:"UPDATE",affected_rows_estimate:15420,query_preview:"UPDATE analytics.customer_segments SET segment = ? WHERE score > ?"},risk_level:"critical",created_at:new Date(Date.now()-12e4).toISOString(),expires_at:new Date(Date.now()+18e5).toISOString(),context:{user_query:"Update customer segments based on new scoring model",step_number:3,previous_actions:["dcl_query","dcl_get_schema"]}}],C=async d=>{if(n){_(!0);try{const a=localStorage.getItem("token");await fetch(`/api/v1/agents/approvals/${n.approval_id}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:a?`Bearer ${a}`:""},body:JSON.stringify({approved:d,notes:k})}),r(m=>m.filter(p=>p.approval_id!==n.approval_id)),v(null),N(""),b?.()}catch(a){console.error("Failed to submit approval:",a)}finally{_(!1)}}},R=d=>{switch(d){case"critical":return{color:"text-red-400",bg:"bg-red-500/20",border:"border-red-500/50"};case"high":return{color:"text-orange-400",bg:"bg-orange-500/20",border:"border-orange-500/50"};case"medium":return{color:"text-yellow-400",bg:"bg-yellow-500/20",border:"border-yellow-500/50"};default:return{color:"text-green-400",bg:"bg-green-500/20",border:"border-green-500/50"}}},D=d=>{const a=new Date(d).getTime()-Date.now();if(a<=0)return"Expired";const m=Math.floor(a/6e4),p=Math.floor(m/60);return p>0?`${p}h ${m%60}m`:`${m}m`},$=j.filter(d=>d.risk_level==="critical").length,q=j.filter(d=>d.risk_level==="high").length;return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-yellow-500/30",children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-lg flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Agent Approval Queue"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Human-in-the-loop decisions for agent actions"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[$>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-red-500/20 rounded-lg",children:[e.jsx(F,{className:"w-4 h-4 text-red-400"}),e.jsxs("span",{className:"text-sm font-medium text-red-400",children:[$," Critical"]})]}),q>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-orange-500/20 rounded-lg",children:[e.jsx(F,{className:"w-4 h-4 text-orange-400"}),e.jsxs("span",{className:"text-sm font-medium text-orange-400",children:[q," High"]})]}),e.jsx("button",{onClick:w,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Refresh",children:e.jsx(O,{className:`w-4 h-4 text-gray-400 ${g?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 divide-y lg:divide-y-0 lg:divide-x divide-gray-700",children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-xs text-gray-400 uppercase tracking-wider mb-3",children:["Pending Approvals (",j.length,")"]}),g?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(O,{className:"w-8 h-8 text-gray-500 animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"Loading approvals..."})]}):j.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(E,{className:"w-12 h-12 text-green-500/50 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"No pending approvals"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"All agent actions are approved"})]}):e.jsx("div",{className:"space-y-3",children:j.map(d=>{const a=R(d.risk_level),m=n?.approval_id===d.approval_id;return e.jsx("button",{onClick:()=>v(d),className:`w-full text-left p-4 rounded-lg border transition-all ${m?"bg-purple-900/30 border-purple-500":`bg-gray-900/50 ${a.border} hover:bg-gray-900`}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${a.bg}`,children:e.jsx(L,{className:`w-4 h-4 ${a.color}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:d.action_type}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${a.bg} ${a.color}`,children:d.risk_level.toUpperCase()})]}),e.jsx("p",{className:"text-xs text-gray-400 truncate mb-2",children:d.context.user_query}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-3 h-3"}),d.agent_name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"}),D(d.expires_at)]})]})]}),e.jsx(Q,{className:"w-4 h-4 text-gray-500"})]})},d.approval_id)})})]}),e.jsx("div",{className:"p-4",children:n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Review Action"}),e.jsxs("a",{href:`/agents/runs/${n.run_id}`,className:"flex items-center gap-1 text-xs text-purple-400 hover:text-purple-300",children:["View Run ",e.jsx(ae,{className:"w-3 h-3"})]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Action Type"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-cyan-400"}),e.jsx("span",{className:"text-lg font-medium text-white",children:n.action_type})]})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Risk Assessment"}),(()=>{const d=R(n.risk_level);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${d.bg}`,children:e.jsx(F,{className:`w-5 h-5 ${d.color}`})}),e.jsxs("span",{className:`text-lg font-medium ${d.color}`,children:[n.risk_level.toUpperCase()," RISK"]})]})})()]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Action Details"}),e.jsx("pre",{className:"text-xs text-gray-300 bg-gray-900 rounded p-3 overflow-x-auto max-h-48",children:JSON.stringify(n.action_details,null,2)})]}),e.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-4 border border-gray-700",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Context"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"User Query:"})," ",e.jsx("span",{className:"text-white",children:n.context.user_query})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Step:"})," ",e.jsxs("span",{className:"text-white",children:["#",n.context.step_number]})]}),n.context.previous_actions.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Previous Actions:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:n.context.previous_actions.map((d,a)=>e.jsx("span",{className:"text-xs bg-gray-800 px-2 py-1 rounded text-gray-300",children:d},a))})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(I,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-gray-400",children:"Expires in:"}),e.jsx("span",{className:"text-yellow-400 font-medium",children:D(n.expires_at)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400 mb-2 flex items-center gap-1",children:[e.jsx(Y,{className:"w-3 h-3"}),"Decision Notes (Optional)"]}),e.jsx("textarea",{value:k,onChange:d=>N(d.target.value),placeholder:"Add notes about your decision...",className:"w-full bg-gray-900 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm placeholder-gray-500 focus:outline-none focus:border-purple-500 transition-colors resize-none",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>C(!0),disabled:h,className:"flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(E,{className:"w-5 h-5"}),"Approve"]}),e.jsxs("button",{onClick:()=>C(!1),disabled:h,className:"flex items-center justify-center gap-2 px-4 py-3 bg-red-600 hover:bg-red-700 disabled:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(P,{className:"w-5 h-5"}),"Reject"]})]})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center py-12",children:[e.jsx(U,{className:"w-16 h-16 text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400 mb-2",children:"Select an approval to review"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-xs",children:"Review action details and context before making a decision"})]})})]})]})}const pe=[{id:"dcl_query",name:"dcl_query",server:"dcl",description:"Execute SQL queries against connected data sources",enabled:!0,requires_approval:!1},{id:"dcl_get_schema",name:"dcl_get_schema",server:"dcl",description:"Get schema information for tables",enabled:!0,requires_approval:!1},{id:"dcl_search_fields",name:"dcl_search_fields",server:"dcl",description:"Search for fields across all tables",enabled:!0,requires_approval:!1},{id:"aod_discover_assets",name:"aod_discover_assets",server:"aod",description:"Discover data assets across systems",enabled:!0,requires_approval:!1},{id:"aod_get_lineage",name:"aod_get_lineage",server:"aod",description:"Trace data lineage for assets",enabled:!0,requires_approval:!1},{id:"aod_explain_field",name:"aod_explain_field",server:"aod",description:"Get detailed field explanations",enabled:!0,requires_approval:!1},{id:"aam_list_connections",name:"aam_list_connections",server:"aam",description:"List all data connections",enabled:!0,requires_approval:!1},{id:"aam_create_connection",name:"aam_create_connection",server:"aam",description:"Create new data connections",enabled:!0,requires_approval:!0},{id:"aam_trigger_sync",name:"aam_trigger_sync",server:"aam",description:"Trigger manual sync for connections",enabled:!0,requires_approval:!0},{id:"aam_repair_drift",name:"aam_repair_drift",server:"aam",description:"Repair schema drift automatically",enabled:!0,requires_approval:!0}],H={agent_id:"",name:"New Agent",description:"A custom AOS agent",system_prompt:`You are an AI assistant for the AutonomOS platform. You help users with:
- Querying and analyzing data from connected sources
- Managing data connections and syncs
- Understanding data lineage and relationships
- Discovering and classifying data assets

Be concise and helpful. Use the available tools to gather information before responding.`,model_tier:"balanced",max_steps:10,tools:pe,approval_rules:[{pattern:"aam_create_*",risk_level:"high",auto_approve:!1},{pattern:"aam_repair_*",risk_level:"medium",auto_approve:!1},{pattern:"dcl_write_*",risk_level:"critical",auto_approve:!1}]};function ge(){const[b,j]=x.useState([]),[r,g]=x.useState(null),[c,n]=x.useState(!1),[v,k]=x.useState("config"),[N,h]=x.useState(""),[_,w]=x.useState([]),[A,C]=x.useState(!1),[R,D]=x.useState(!1);x.useEffect(()=>{$()},[]);const $=async()=>{try{const s=localStorage.getItem("token"),i=await fetch("/api/v1/agents",{headers:{Authorization:s?`Bearer ${s}`:""}});if(i.ok){const u=await i.json();j(u.agents||[])}}catch{j([{...H,agent_id:"agent-default",name:"AOS Agent"}])}},q=()=>{const s={...H,agent_id:`agent-${Date.now()}`,name:"New Agent"};g(s),n(!0),k("config")},d=async()=>{if(r){D(!0);try{const s=localStorage.getItem("token"),i=!b.find(t=>t.agent_id===r.agent_id),u=await fetch(`/api/v1/agents${i?"":`/${r.agent_id}`}`,{method:i?"POST":"PUT",headers:{"Content-Type":"application/json",Authorization:s?`Bearer ${s}`:""},body:JSON.stringify(r)});if(u.ok){const t=await u.json();j(i?y=>[...y,t]:y=>y.map(l=>l.agent_id===r.agent_id?t:l)),n(!1)}}catch(s){console.error("Failed to save agent:",s);const i=!b.find(u=>u.agent_id===r.agent_id);j(i?u=>[...u,r]:u=>u.map(t=>t.agent_id===r.agent_id?r:t)),n(!1)}finally{D(!1)}}},a=async()=>{if(!(!r||!N.trim())){C(!0);try{const s=localStorage.getItem("token"),i=await fetch(`/api/v1/agents/${r.agent_id}/test`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:s?`Bearer ${s}`:""},body:JSON.stringify({input:N})});if(i.ok){const u=await i.json();w(t=>[u,...t])}}catch{const i={test_id:`test-${Date.now()}`,input:N,actual_output:"Mock response for: "+N,tools_called:["dcl_query","dcl_get_schema"],tokens_used:1500,cost_usd:.012,duration_ms:2500,passed:!0};w(u=>[i,...u])}finally{C(!1),h("")}}},m=s=>{r&&g({...r,tools:r.tools.map(i=>i.id===s?{...i,enabled:!i.enabled}:i)})},p=s=>{r&&g({...r,tools:r.tools.map(i=>i.id===s?{...i,requires_approval:!i.requires_approval}:i)})};return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700",children:[e.jsxs("div",{className:"px-4 py-4 border-b border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center",children:e.jsx(z,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Agent Workbench"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Create, configure, and test agents"})]})]}),e.jsxs("button",{onClick:q,className:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"New Agent"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 divide-y lg:divide-y-0 lg:divide-x divide-gray-700",children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"text-xs text-gray-400 uppercase tracking-wider mb-3",children:["Agents (",b.length,")"]}),e.jsxs("div",{className:"space-y-2",children:[b.map(s=>e.jsxs("button",{onClick:()=>{g(s),n(!1)},className:`w-full text-left p-3 rounded-lg border transition-all ${r?.agent_id===s.agent_id?"bg-purple-900/30 border-purple-500":"bg-gray-900/50 border-gray-700 hover:bg-gray-900"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(T,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:s.name})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:s.description}),e.jsx("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"}),s.tools.filter(i=>i.enabled).length," tools"]})})]},s.agent_id)),b.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No agents yet"}),e.jsx("button",{onClick:q,className:"mt-3 text-purple-400 hover:text-purple-300 text-sm",children:"Create your first agent"})]})]})]}),e.jsx("div",{className:"lg:col-span-3 p-4",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1 mb-4 border-b border-gray-700 pb-3",children:[[{id:"config",label:"Configuration",icon:z},{id:"tools",label:"Tools",icon:L},{id:"rules",label:"Approval Rules",icon:U},{id:"test",label:"Test",icon:J}].map(s=>e.jsxs("button",{onClick:()=>k(s.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors ${v===s.id?"bg-purple-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label]},s.id)),e.jsx("div",{className:"flex-1"}),c&&e.jsxs("button",{onClick:d,disabled:R,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-700 text-white rounded-lg text-sm font-medium transition-colors",children:[R?e.jsx(O,{className:"w-4 h-4 animate-spin"}):e.jsx(re,{className:"w-4 h-4"}),"Save"]}),!c&&e.jsxs("button",{onClick:()=>n(!0),className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm font-medium transition-colors",children:[e.jsx(z,{className:"w-4 h-4"}),"Edit"]})]}),v==="config"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400 mb-1 block",children:"Agent Name"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>c&&g({...r,name:s.target.value}),disabled:!c,className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white disabled:opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400 mb-1 block",children:"Description"}),e.jsx("input",{type:"text",value:r.description,onChange:s=>c&&g({...r,description:s.target.value}),disabled:!c,className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white disabled:opacity-50"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400 mb-1 block",children:"Model Tier"}),e.jsxs("select",{value:r.model_tier,onChange:s=>c&&g({...r,model_tier:s.target.value}),disabled:!c,className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white disabled:opacity-50",children:[e.jsx("option",{value:"fast",children:"Fast (Haiku)"}),e.jsx("option",{value:"balanced",children:"Balanced (Sonnet)"}),e.jsx("option",{value:"powerful",children:"Powerful (Opus)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400 mb-1 block",children:"Max Steps"}),e.jsx("input",{type:"number",value:r.max_steps,onChange:s=>c&&g({...r,max_steps:parseInt(s.target.value)||10}),disabled:!c,min:1,max:50,className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white disabled:opacity-50"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400 mb-1 block",children:"System Prompt"}),e.jsx("textarea",{value:r.system_prompt,onChange:s=>c&&g({...r,system_prompt:s.target.value}),disabled:!c,rows:8,className:"w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white disabled:opacity-50 font-mono text-sm resize-none"})]})]}),v==="tools"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:'Enable or disable tools available to this agent. Tools marked as "Requires Approval" will trigger HITL review before execution.'}),r.tools.map(s=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx("button",{onClick:()=>c&&m(s.id),disabled:!c,className:`p-2 rounded-lg transition-colors ${s.enabled?"bg-green-500/20 text-green-400":"bg-gray-800 text-gray-500"}`,children:s.enabled?e.jsx(E,{className:"w-5 h-5"}):e.jsx(P,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",s.server,")"]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:s.description})]}),e.jsxs("button",{onClick:()=>c&&p(s.id),disabled:!c,className:`flex items-center gap-1 px-3 py-1 rounded-lg text-xs transition-colors ${s.requires_approval?"bg-yellow-500/20 text-yellow-400":"bg-gray-800 text-gray-500 hover:bg-gray-700"}`,children:[e.jsx(U,{className:"w-3 h-3"}),s.requires_approval?"Requires Approval":"Auto-approve"]})]},s.id))]}),v==="rules"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Configure approval rules for tool execution. Matching patterns trigger human review."}),r.approval_rules.map((s,i)=>e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-900/50 rounded-lg border border-gray-700",children:[e.jsx(ne,{className:"w-5 h-5 text-cyan-400"}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:s.pattern,onChange:u=>{if(!c)return;const t=[...r.approval_rules];t[i]={...s,pattern:u.target.value},g({...r,approval_rules:t})},disabled:!c,className:"bg-transparent text-sm text-white font-mono disabled:opacity-50 w-full"})}),e.jsxs("select",{value:s.risk_level,onChange:u=>{if(!c)return;const t=[...r.approval_rules];t[i]={...s,risk_level:u.target.value},g({...r,approval_rules:t})},disabled:!c,className:"bg-gray-800 border border-gray-700 rounded px-2 py-1 text-xs text-white disabled:opacity-50",children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"critical",children:"Critical"})]}),c&&e.jsx("button",{onClick:()=>{const u=r.approval_rules.filter((t,y)=>y!==i);g({...r,approval_rules:u})},className:"p-1 text-red-400 hover:bg-red-500/20 rounded",children:e.jsx(le,{className:"w-4 h-4"})})]},i)),c&&e.jsxs("button",{onClick:()=>{g({...r,approval_rules:[...r.approval_rules,{pattern:"*",risk_level:"low",auto_approve:!1}]})},className:"flex items-center gap-2 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"Add Rule"]})]}),v==="test"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-400 mb-1 block",children:"Test Input"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:N,onChange:s=>h(s.target.value),placeholder:"Enter a test query...",className:"flex-1 px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500",onKeyDown:s=>s.key==="Enter"&&a()}),e.jsxs("button",{onClick:a,disabled:A||!N.trim(),className:"flex items-center gap-2 px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700 text-white rounded-lg font-medium transition-colors",children:[A?e.jsx(O,{className:"w-4 h-4 animate-spin"}):e.jsx(J,{className:"w-4 h-4"}),"Run Test"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:["Test Results (",_.length,")"]}),e.jsxs("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[_.map(s=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.passed?"bg-green-900/20 border-green-500/30":"bg-red-900/20 border-red-500/30"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.passed?e.jsx(E,{className:"w-4 h-4 text-green-400"}):e.jsx(P,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:s.passed?"Passed":"Failed"}),e.jsx("div",{className:"flex-1"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[s.duration_ms,"ms |"," ",s.tokens_used," tokens |"," ","$",s.cost_usd.toFixed(4)]})]}),e.jsxs("div",{className:"text-sm text-gray-400 mb-2",children:[e.jsx("span",{className:"text-gray-500",children:"Input:"})," ",s.input]}),s.actual_output&&e.jsx("div",{className:"text-sm text-gray-300 bg-gray-900/50 rounded p-2 mb-2",children:s.actual_output}),s.error&&e.jsx("div",{className:"text-sm text-red-400 bg-red-900/30 rounded p-2 mb-2",children:s.error}),s.tools_called.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.tools_called.map((i,u)=>e.jsx("span",{className:"text-xs bg-gray-800 px-2 py-1 rounded text-cyan-400",children:i},u))})]},s.test_id)),_.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(J,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No test results yet"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:'Enter a query and click "Run Test"'})]})]})]})]})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center py-12",children:[e.jsx(T,{className:"w-16 h-16 text-gray-600 mb-4"}),e.jsx("p",{className:"text-gray-400 mb-2",children:"Select an agent to configure"}),e.jsx("p",{className:"text-sm text-gray-500 max-w-md",children:"Choose an agent from the list or create a new one to get started"})]})})]})]})}function be(){const[b,j]=x.useState("chat"),[r,g]=x.useState(3),c=[{id:"chat",label:"Chat",icon:Y},{id:"history",label:"Run History",icon:I},{id:"approvals",label:"Approvals",icon:U,badge:r},{id:"scheduler",label:"Scheduler",icon:ie},{id:"workbench",label:"Workbench",icon:z}];return e.jsxs("div",{className:"space-y-6 px-4 sm:px-6 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(T,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Agent Control Center"}),e.jsx("p",{className:"text-gray-400",children:"Interact with AI agents, review actions, and manage configurations"})]})]}),e.jsxs("div",{className:"hidden lg:flex items-center gap-6 bg-gray-800/50 rounded-lg px-6 py-3 border border-gray-700",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:"1"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Active Agent"})]}),e.jsx("div",{className:"w-px h-8 bg-gray-700"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-cyan-400",children:"24"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Runs Today"})]}),e.jsx("div",{className:"w-px h-8 bg-gray-700"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-400",children:r}),e.jsx("div",{className:"text-xs text-gray-400",children:"Pending"})]}),e.jsx("div",{className:"w-px h-8 bg-gray-700"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:"$2.47"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Cost Today"})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 border-b border-gray-700 pb-4",children:c.map(n=>e.jsxs("button",{onClick:()=>j(n.id),className:`flex items-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-all ${b===n.id?"bg-purple-600 text-white shadow-lg shadow-purple-500/20":"text-gray-400 hover:text-white hover:bg-gray-800"}`,children:[e.jsx(n.icon,{className:"w-4 h-4"}),n.label,n.badge!==void 0&&n.badge>0&&e.jsx("span",{className:`ml-1 px-2 py-0.5 text-xs rounded-full ${b===n.id?"bg-white/20 text-white":"bg-yellow-500/20 text-yellow-400"}`,children:n.badge})]},n.id))}),e.jsxs("div",{className:"min-h-[600px]",children:[b==="chat"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 h-[600px]",children:e.jsx(de,{agentId:"default",agentName:"AOS Agent",onRunComplete:()=>{}})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white mb-3",children:"Quick Actions"}),e.jsx("div",{className:"space-y-2",children:[{label:"Check connector status",icon:oe},{label:"Show recent data changes",icon:I},{label:"Run data quality check",icon:U}].map((n,v)=>e.jsxs("button",{className:"w-full flex items-center gap-2 px-3 py-2 bg-gray-900/50 hover:bg-gray-900 rounded-lg text-sm text-gray-300 hover:text-white transition-colors text-left",children:[e.jsx(n.icon,{className:"w-4 h-4 text-purple-400"}),n.label]},v))})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-white",children:"Recent Runs"}),e.jsx("button",{onClick:()=>j("history"),className:"text-xs text-purple-400 hover:text-purple-300",children:"View all"})]}),e.jsx("div",{className:"space-y-2",children:[{query:"Revenue Q4 2025",status:"completed",time:"2m ago"},{query:"Create SF connection",status:"waiting",time:"10m ago"},{query:"Data lineage trace",status:"completed",time:"30m ago"}].map((n,v)=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-gray-900/50 rounded-lg",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.status==="completed"?"bg-green-400":n.status==="waiting"?"bg-yellow-400":"bg-gray-400"}`}),e.jsx("span",{className:"flex-1 text-xs text-gray-300 truncate",children:n.query}),e.jsx("span",{className:"text-xs text-gray-500",children:n.time})]},v))})]}),r>0&&e.jsxs("div",{className:"bg-yellow-900/20 rounded-lg border border-yellow-500/30 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(U,{className:"w-4 h-4 text-yellow-400"}),e.jsxs("h3",{className:"text-sm font-medium text-yellow-400",children:[r," Pending Approvals"]})]}),e.jsx("p",{className:"text-xs text-gray-400 mb-3",children:"Agent actions require your review"}),e.jsx("button",{onClick:()=>j("approvals"),className:"w-full px-3 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg text-sm font-medium transition-colors",children:"Review Now"})]})]})]}),b==="history"&&e.jsx(xe,{}),b==="approvals"&&e.jsx(me,{onApprovalComplete:()=>{g(n=>Math.max(0,n-1))}}),b==="scheduler"&&e.jsx(ce,{}),b==="workbench"&&e.jsx(ge,{})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500",children:["Agent Control Center  Powered by LangGraph + MCP "," ",e.jsx("a",{href:"#",className:"text-purple-400 hover:text-purple-300",children:"Documentation"})]})]})}export{be as default};
