import{r as a,j as e,o as I,e as S,p as q,T as G,q as x,h as P,D as C,A as U}from"./ui-vendor-qieckf7c.js";import{D as _}from"./DemoStep-TfYJ6XkI.js";import{A as k}from"./index-CXyvdn7C.js";import"./react-vendor-BdZgHC1P.js";const Q=[{value:"CFO",label:"CFO (Finance)",icon:q,color:"text-green-400"},{value:"CRO",label:"CRO (Revenue)",icon:G,color:"text-blue-400"},{value:"general",label:"General",icon:x,color:"text-purple-400"}];function c(t){switch(t){case"source":return e.jsx(C,{className:"w-4 h-4"});case"ontology":return e.jsx(U,{className:"w-4 h-4"});case"agent":return e.jsx(x,{className:"w-4 h-4"});default:return e.jsx(C,{className:"w-4 h-4"})}}function d(t){switch(t){case"source":return"bg-blue-500/20 border-blue-500/40 text-blue-400";case"ontology":return"bg-purple-500/20 border-purple-500/40 text-purple-400";case"agent":return"bg-green-500/20 border-green-500/40 text-green-400";default:return"bg-gray-500/20 border-gray-500/40 text-gray-400"}}function M(){const[t,A]=a.useState(null),[i,u]=a.useState(!0),[m,p]=a.useState(null),[l,o]=a.useState(""),[g,R]=a.useState("general"),[h,b]=a.useState(!1),[n,D]=a.useState(null),[y,f]=a.useState(null),j=async()=>{u(!0),p(null);try{const s=await fetch(k.buildApiUrl("/demo/dcl/graph"));if(!s.ok)throw new Error("Failed to fetch graph");const r=await s.json();A(r)}catch(s){p(s instanceof Error?s.message:"Unknown error")}finally{u(!1)}};a.useEffect(()=>{j()},[]);const E=async s=>{if(s.preventDefault(),!!l.trim()){b(!0),f(null);try{const r=await fetch(k.buildApiUrl("/demo/dcl/query"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:l,persona:g})});if(!r.ok)throw new Error("Query failed");const O=await r.json();D(O)}catch(r){f(r instanceof Error?r.message:"Unknown error")}finally{b(!1)}}},N=t?.nodes.filter(s=>s.type==="source")||[],v=t?.nodes.filter(s=>s.type==="ontology")||[],w=t?.nodes.filter(s=>s.type==="agent")||[];return e.jsx("div",{className:"h-full flex flex-col overflow-hidden",children:e.jsx(_,{stepNumber:3,title:"Unify & Ask",description:"Your data is unified into a canonical ontology. Ask questions in natural language and get answers powered by AI.",instructions:"Select a persona (CFO, CRO) to get role-specific insights, then ask a question about your unified data.",children:e.jsx("div",{className:"h-full overflow-auto p-3 sm:p-4 lg:p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 lg:gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-300 uppercase tracking-wider",children:"Canonical Graph"}),e.jsx("button",{onClick:j,disabled:i,className:"p-1.5 rounded-lg bg-gray-700/50 hover:bg-gray-700 text-gray-400 hover:text-white transition-colors disabled:opacity-50",children:e.jsx(I,{className:`w-4 h-4 ${i?"animate-spin":""}`})})]}),i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(S,{className:"w-8 h-8 text-cyan-400 animate-spin"})}):m?e.jsx("div",{className:"text-red-400 text-sm bg-red-900/20 border border-red-500/30 rounded-lg p-3",children:m}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[e.jsxs("div",{className:"bg-blue-900/20 border border-blue-500/30 rounded-lg p-2 sm:p-3 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-400",children:t.summary.total_sources||N.length}),e.jsx("div",{className:"text-xs text-gray-400",children:"Sources"})]}),e.jsxs("div",{className:"bg-purple-900/20 border border-purple-500/30 rounded-lg p-2 sm:p-3 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-purple-400",children:t.summary.total_entities||v.length}),e.jsx("div",{className:"text-xs text-gray-400",children:"Entities"})]}),e.jsxs("div",{className:"bg-green-900/20 border border-green-500/30 rounded-lg p-2 sm:p-3 text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-green-400",children:t.summary.total_agents||w.length}),e.jsx("div",{className:"text-xs text-gray-400",children:"Agents"})]})]}),t.summary.records_unified&&e.jsxs("div",{className:"bg-cyan-900/20 border border-cyan-500/30 rounded-lg p-3 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Records Unified"}),e.jsx("span",{className:"text-lg font-bold text-cyan-400",children:t.summary.records_unified.toLocaleString()})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-blue-400 mb-2",children:"Data Sources"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(s=>e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs border ${d("source")}`,children:[c("source"),s.label]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-purple-400 mb-2",children:"Canonical Entities"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(s=>e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs border ${d("ontology")}`,children:[c("ontology"),s.label]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium text-green-400 mb-2",children:"Active Agents"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(s=>e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-xs border ${d("agent")}`,children:[c("agent"),s.label]},s.id))})]})]}),t.source==="stub"&&e.jsx("div",{className:"text-xs text-amber-400/70 bg-amber-900/20 border border-amber-500/30 rounded-lg px-3 py-2",children:"Demo mode: showing sample data. Connect DCL v2 for live data."})]}):null]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-300 uppercase tracking-wider",children:"Ask Your Data"}),e.jsxs("form",{onSubmit:E,className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:Q.map(s=>{const r=s.icon;return e.jsxs("button",{type:"button",onClick:()=>R(s.value),className:`inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium border transition-all ${g===s.value?"bg-cyan-600/30 border-cyan-500/60 text-cyan-300":"bg-gray-700/30 border-gray-600/40 text-gray-400 hover:border-gray-500/60 hover:text-gray-300"}`,children:[e.jsx(r,{className:`w-3.5 h-3.5 ${s.color}`}),s.label]},s.value)})}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:l,onChange:s=>o(s.target.value),placeholder:"Ask a question about your unified data...",className:"w-full h-24 sm:h-28 bg-gray-900/50 border border-gray-600/40 rounded-lg px-3 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-cyan-500/50 resize-none"}),e.jsx("button",{type:"submit",disabled:h||!l.trim(),className:"absolute bottom-2 right-2 p-2 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-white disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:h?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(P,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 text-xs text-gray-500",children:[e.jsx("span",{children:"Try:"}),e.jsx("button",{type:"button",onClick:()=>o("What is my current MRR and churn risk?"),className:"text-cyan-400/70 hover:text-cyan-400 underline",children:'"What is my current MRR?"'}),e.jsx("span",{children:"or"}),e.jsx("button",{type:"button",onClick:()=>o("Show me pipeline analysis"),className:"text-cyan-400/70 hover:text-cyan-400 underline",children:'"Pipeline analysis"'})]})]}),y&&e.jsx("div",{className:"text-red-400 text-sm bg-red-900/20 border border-red-500/30 rounded-lg p-3",children:y}),n&&e.jsxs("div",{className:"bg-gray-900/50 border border-gray-600/40 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-cyan-900/30 to-purple-900/30 border-b border-gray-600/40 px-3 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"AI Response"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:"Confidence:"}),e.jsxs("span",{className:`text-xs font-medium ${n.confidence>=.9?"text-green-400":n.confidence>=.7?"text-yellow-400":"text-red-400"}`,children:[Math.round(n.confidence*100),"%"]})]})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-200 leading-relaxed",children:n.answer}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 pt-2 border-t border-gray-700/50",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Referenced:"}),n.entities_referenced.map(s=>e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-purple-500/20 border border-purple-500/40 text-purple-300",children:s},s))]}),n.source==="stub"&&e.jsx("div",{className:"text-xs text-amber-400/70 italic",children:"Demo response (DCL v2 not connected)"})]})]})]})]})})})})}export{M as default};
