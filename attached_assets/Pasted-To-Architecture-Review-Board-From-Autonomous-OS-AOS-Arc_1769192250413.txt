To: Architecture Review Board
From: Autonomous OS (AOS) Architecture Audit
Date: January 23, 2026
Subject: Master RACI & Code-Level Refactoring Directives

### 1. Assessment of Inputs & Critical Correction

**⚠️ Critical Observation:** The file you attached labeled `RACI_MATRIX (2).md` (intended for AOA) is a **duplicate of the AOD (Discovery) matrix** (containing "Shadow IT," "Asset discovery," etc.). It does **not** contain any Agent Orchestration capabilities.

**Correction Strategy:**
To ensure the audit is complete and does not stall, I have **synthesized the AOA (Orchestration) layer** in the Master Matrix below. This synthesis is derived directly from our agreed architectural pivot:

1. **AOA** must absorb the **Infrastructure/Worker Pools** (previously conflated with FARM).
2. **AOA** must own the **Action Router** (the "Hands" that direct intents to the Fabric).

---

### 2. The Consolidated AOS Master RACI

This matrix represents the **Single Source of Truth**. It overrides all previous conflicting inputs. It resolves the "Split-Brain" (Ops vs. Verify) and "Zero-Trust" (Buffering) violations.

| Category | Capability | AOD | AAM | DCL | AOA | FARM | Architectural Notes |
| --- | --- | --- | --- | --- | --- | --- | --- |
| **DISCOVERY (AOD)** |  |  |  |  |  |  | *The Senses* |
| **Fabric Detection** | **Fabric Plane Identification** (MuleSoft, Kafka, Snowflake) | **A/R** | C |  |  |  | *Detects the Backbone, not just endpoints* |
|  | **Enterprise Preset Inference** (Scrappy vs Platform) | **A/R** | C |  |  |  | *Classifies Org Architecture* |
|  | Connection Routing Logic (Set `connected_via_plane`) | **A/R** | I |  |  |  | *Context for AAM Handoff* |
| **Asset Scan** | Asset Discovery (Legacy Endpoints) | A/R |  |  |  |  | *Legacy Fallback* |
|  | **Policy Manifest Export** (Governance Rules) | **A/R** | C |  |  |  | *Export rules for AAM to enforce* |
| **Handoff** | ConnectionCandidate Export | A/R | I |  |  |  | *Sends Target + Preset to AAM* |
| **MESH (AAM)** |  |  |  |  |  |  | *The Fabric* |
| **Fabric Mgmt** | **Fabric Plane Connection** (The Backbone) |  | **A/R** |  |  | I | *Connects to Planes, not Apps* |
|  | **Preset Config Loading** (6, 8, 9, 11) |  | **A/R** |  |  | I | *Configures Mesh behavior* |
|  | Routing Policy Enforcement |  | A/R |  |  | I | *Enforces "Block Direct Access"* |
| **Adapters** | Adapter Factory Resolution |  | A/R |  |  | I | *Instantiates Strategy (Gateway vs Bus)* |
| **Self-Healing** | **Connection/Fabric Drift Detection** |  | **A/R** |  |  | I | *Detects lost connectivity to Plane* |
|  | **Execute Self-Heal** (Restart Consumers) |  | **A/R** |  |  | I | *Restarts Consumers/Reconnects* |
| **Governance** | PII Redaction (Edge) |  | **A/R** |  |  | I | *Redacts before data enters DCL* |
| **CONNECTIVITY (DCL)** |  |  |  |  |  |  | *The Brain* |
| **Ingestion** | **Fabric Pointer Buffering** (Zero-Trust) |  |  | **A/R** |  | I | *buffers Pointers, NOT Payloads* |
|  | Just-in-Time Payload Fetching |  | C | **R** |  |  | *Fetch only on Semantic Map request* |
|  | Schema Drift Detection |  | C | A/R |  | C | *Field changes (not connection)* |
| **Contract** | **Downstream Consumer Protocol** (BLL Stub) |  |  | **A/R** |  | C | *Interface for BLL Agents* |
| **Visualization** | **Topology API Exposure** |  | I | A/R |  |  | *Backend for Graph UI* |
| **ORCHESTRATION (AOA)** |  |  |  |  |  |  | *The Hands (Synthesized)* |
| **Action** | **Fabric Action Routing** |  | C |  | **A/R** | I | *Routes "Write" intent to Fabric Plane* |
|  | Transaction Execution |  | R |  | **A/R** | I | *Executes via AAM Adapters* |
| **Runtime** | **Worker Pool Management** (Infra) |  |  |  | **A/R** | I | *Moved from FARM (Ops)* |
|  | Task Queue Management |  |  |  | **A/R** | I | *Moved from FARM (Ops)* |
| **Security** | **Context Sanitization** |  |  |  | **A/R** | C | *Security layer before Agent Logic* |
| **VERIFICATION (FARM)** |  |  |  |  |  |  | *The Judge* |
| **Truth** | **Ground Truth Validation** | C | C | C |  | **A/R** | *The "Test Oracle"* |
|  | End-to-End Injection Tests |  | I | I |  | **A/R** | *Injects at AAM, verifies at DCL* |
|  | Accuracy Measurement | R | R |  |  | **A/R** |  |

---

### 3. Code-Level Prompts (Actionable)

Copy and paste these prompts directly to your coding agents. They are designed to enforce the architecture **even where the legacy files might be ambiguous.**

#### 0. Global Context Injection (Paste First)

> **Role:** System Architect
> **Context:** We are refactoring the AOS platform.
> **Critical Constraint:** The system DOES NOT connect "Point-to-Point" (P2P) unless in "Scrappy" mode. We connect to **"Fabric Planes"** (MuleSoft, Kafka, Snowflake) based on the client's **"Enterprise Preset"**.
> **The 4 Presets:**
> 1. **Preset 6 (Scrappy):** P2P API connections allowed.
> 2. **Preset 8 (iPaaS-Centric):** Integration Logic must flow via iPaaS (e.g., Workato).
> 3. **Preset 9 (Platform-Oriented):** High-volume data flows via Event Bus (Kafka).
> 4. **Preset 11 (Warehouse-Centric):** Source of Truth is the Warehouse (Snowflake).
> 
> 

#### Agent Target: AOD (Discovery)

**Mission:** Stop scanning IP addresses. Start querying "Motherships" to find the Enterprise Preset.

```text
# CODING DIRECTIVE: FABRIC DISCOVERY & PRESET ENGINE
**Role:** Lead Engineer for AOD (Discovery)

**Code Action Items:**
1.  **Refactor `DiscoveryScanner`:**
    *   Create a new module `FabricProbe.py`.
    *   Prioritize querying Control Plane Metadata APIs:
        *   `MuleSoft Anypoint API` / `Workato Recipes API`
        *   `Kafka Broker Metadata`
        *   `Snowflake INFORMATION_SCHEMA`
2.  **Implement `PresetInferenceEngine`:**
    *   Analyze the density of assets behind these planes.
    *   *Logic:* IF >50% of assets are iPaaS managed -> Return `PresetContext(PRESET_8_IPAAS)`.
    *   *Logic:* IF key Domain Tables exist in Snowflake -> Return `PresetContext(PRESET_11_WAREHOUSE)`.
3.  **Update Handoff Object:**
    *   Refactor `ConnectionCandidate`. Add field: `FabricRoute` (Enum: `VIA_GATEWAY`, `VIA_BUS`, `VIA_WAREHOUSE`, `VIA_DIRECT`).
    *   *Constraint:* Do not recommend `VIA_DIRECT` unless the Preset is "Scrappy".

```

#### Agent Target: AAM (Mesh)

**Mission:** Build the Fabric Adapters and Reclaim Self-Healing.

```text
# CODING DIRECTIVE: FABRIC ADAPTERS & SELF-HEALING
**Role:** Architect for AAM (Mesh)
**Context:** You are the Fabric Switch. You do not connect to Apps directly.

**Code Action Items:**
1.  **Delete Legacy Connectors:** Remove `SalesforceConnector`, `HubSpotConnector`.
2.  **Create Fabric Strategy Pattern:**
    *   Interface `IFabricAdapter`. Implementations:
        *   `IPaaSAdapter` (Webhooks/Signals)
        *   `GatewayAdapter` (Kong/Apigee Proxy)
        *   `EventBusAdapter` (Kafka Consumer)
        *   `WarehouseAdapter` (JDBC Read)
3.  **Implement `SelfHealingLoop`:**
    *   Migrate `Repair` logic from FARM.
    *   *Logic:* If `Adapter.healthCheck()` fails (e.g., Consumer Lag), trigger `Adapter.reconnect()` immediately.
4.  **Enforce Policy:**
    *   Ingest `PolicyManifest` from AOD.
    *   If `Manifest.BlockDirectAccess == True`, reject connections using `GatewayAdapter`.

```

#### Agent Target: DCL (Connectivity)

**Mission:** Enforce Zero Trust (Pointer Buffering) and Stub the BLL.

```text
# CODING DIRECTIVE: ZERO-TRUST POINTER BUFFERING
**Role:** Principal Engineer for DCL
**Critical Security Override:** The RACI mentions "Record Buffering." You must interpret this as "Pointer Buffering."

**Code Action Items:**
1.  **Refactor Ingestion Buffer:**
    *   Rename `RecordBuffer` to `FabricPointerBuffer`.
    *   Change internal storage from `Payload{JsonBody}` to `FabricPointer{Source, Topic, Offset}`.
    *   *Security:* Ensure NO customer data is serialized to disk.
2.  **Implement `JustInTimeFetcher`:**
    *   The Semantic Mapper must use the `FabricPointer` to fetch the payload from the Source (Kafka/Snowflake) *only* at the moment of processing (in-memory).
3.  **Stub Consumer Protocol:**
    *   Create `DownstreamConsumerAPI`.
    *   Define `subscribe_to_entity(id)` and `query_graph(snapshot)`. This is the socket for future BLL Agents.

```

#### Agent Target: AOA (Orchestration)

**Mission:** Build the Action Router and absorb Infrastructure.

```text
# CODING DIRECTIVE: ACTION ROUTER & INFRA STRUCTURE
**Role:** Systems Architect for AOA
**Context:** You are the "Hands" (Execution) and the "Muscle" (Infrastructure).

**Code Action Items:**
1.  **Implement `ActionRouter`:**
    *   Route "Write Intents" based on `PresetContext`.
    *   *Logic:* If `Preset == IPAAS`, trigger `Webhook(Recipe_ID)`. Do not call API.
    *   *Logic:* If `Preset == PLATFORM`, publish `CommandEvent` to Bus.
2.  **Absorb Infrastructure:**
    *   Implement `WorkerPoolManager` (Migrate code from FARM).
    *   You are responsible for scaling Agent containers.
3.  **Context Sanitization:**
    *   Implement middleware to strip PII from Context before injecting into LLM Prompts.

```

#### Agent Target: FARM (Verification)

**Mission:** Become the Pure Test Oracle.

```text
# CODING DIRECTIVE: PURE VERIFICATION
**Role:** QA Lead for FARM
**Context:** You are NOT Operations. You are QA.

**Code Action Items:**
1.  **Purge Ops Code:**
    *   DELETE `WorkerPool`, `LoadBalancer`, `SelfHeal` modules.
2.  **Implement `InjectionTestHarness`:**
    *   Create logic to inject "Canary Records" into the AAM Fabric.
    *   Poll DCL Topology to verify arrival and mapping.
3.  **Reporting:**
    *   Report strictly on **Data Accuracy** and **Latency**.

```