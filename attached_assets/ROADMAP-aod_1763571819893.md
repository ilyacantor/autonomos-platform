# AOS Discover v2 - Product Roadmap

## Executive Summary
AOS Discover v2 is a microservice within the larger AOS platform, focused on hybrid AI/ML asset discovery and classification. This roadmap follows a priority-based approach driven by customer feedback and platform needs, organized into **Now / Next / Later** horizons rather than fixed timelines.

---

## Current State (MVP Complete ‚úÖ)

### Core Discovery & Classification
- ‚úÖ Hybrid discovery engine (Rules-only, ML-only, Hybrid modes)
- ‚úÖ Multi-signal feature extraction and ML models (GradientBoosting + IsolationForest)
- ‚úÖ Digital twin synthetic data generation (10 archetypes)
- ‚úÖ Real-time asset state management via PostgreSQL

### HITL Triage System
- ‚úÖ 4-queue risk-based categorization (HIGH RISK ‚â•0.7, MEDIUM RISK 0.4-0.69, SHADOW IT, DATA CONFLICTS)
- ‚úÖ Complete state transition workflows with due process enforcement
- ‚úÖ 10+ triage actions with full audit trail
- ‚úÖ Operating instructions for non-technical users

### Infrastructure
- ‚úÖ PostgreSQL-based state management (single-tenant)
- ‚úÖ RESTful API + CLI interfaces
- ‚úÖ Professional SecOps dashboard with 5-tab navigation
- ‚úÖ Background job orchestration with progress tracking

### Current Limitations
- ‚ö†Ô∏è Single-tenant deployment only
- ‚ö†Ô∏è Database connection pool contention under 50+ concurrent users
- ‚ö†Ô∏è Audit trail and experiments stored in files, not database
- ‚ö†Ô∏è Manual trigger for model retraining

---

## Priority Horizon: NOW
**Immediate priorities based on platform requirements and technical dependencies**

### 1. Database Migration to Supabase with Multi-Tenancy üî¥ **CRITICAL PATH**

**Why First:** Foundation for all future scaling and enterprise deployments

#### 1.1 Schema Evolution
- [ ] Add `tenants` table with organization metadata
- [ ] Add `tenant_id` to all existing tables (assets, future audit/experiments)
- [ ] Migrate audit trail from JSONL to database table
- [ ] Migrate experiments history from JSON files to database table
- [ ] Implement composite indexes for tenant-scoped queries

#### 1.2 Row-Level Security (RLS)
- [ ] Create Supabase RLS policies for tenant isolation
- [ ] Implement service-role access for admin operations
- [ ] Add tenant context to all API endpoints
- [ ] Validate cross-tenant data isolation

#### 1.3 Connection Management
- [ ] Override Replit's sticky Neon configuration
- [ ] Implement `SUPABASE_URL` environment variable handling
- [ ] Create connection routing logic to force Supabase over PG* vars
- [ ] Update connection pool configuration for Supabase

#### 1.4 Data Migration
- [ ] Export existing 415 assets from Neon PostgreSQL
- [ ] Transform data with tenant assignments
- [ ] Import to Supabase with validation
- [ ] Migrate audit trail history (workflow_executions.jsonl)
- [ ] Migrate experiment history (experiments/*.json)

**Success Criteria:**
- Zero data loss during migration
- Sub-100ms query performance maintained
- Successful tenant isolation testing
- All existing functionality working with Supabase

### 2. Performance Optimization (Post-Migration)

#### 2.1 Connection Pool Tuning
- [ ] Dynamic pool sizing based on load
- [ ] Investigate Supabase connection pooler (Supavisor)
- [ ] Optimize pool parameters for 100+ concurrent users

#### 2.2 Query Optimization
- [ ] Analyze slow queries with Supabase dashboard
- [ ] Add strategic indexes for common query patterns
- [ ] Optimize materialized view refresh strategy

#### 2.3 Caching Strategy
- [ ] Implement Redis for hot data caching
- [ ] Cache invalidation improvements
- [ ] Query result caching for expensive aggregations

**Success Criteria:**
- Support 100+ concurrent users
- P95 latency <2s under load
- Zero timeout errors

---

## Priority Horizon: NEXT
**Value-adds after core infrastructure is solid**

### 3. Discovery Intelligence Enhancement üß† **MICROSERVICE FOCUS**

**Why Next:** Core differentiator of our microservice within AOS platform

#### 3.1 Active Learning from HITL Feedback
- [ ] Capture analyst decisions as training signals
- [ ] Implement feedback loop for model improvement
- [ ] A/B testing framework for model versions
- [ ] Shadow mode testing (new models in parallel)

#### 3.2 Explainable AI (XAI)
- [ ] SHAP/LIME integration for decision transparency
- [ ] Feature importance dashboard
- [ ] Confidence intervals on predictions
- [ ] Human-readable explanation generation

#### 3.3 Advanced Detection Patterns
- [ ] Time-series drift detection
- [ ] Anomaly clustering for similar threats
- [ ] Behavioral pattern analysis
- [ ] Cross-asset relationship graphs

**Success Criteria:**
- F1 score >90% sustained
- 30% reduction in false positives
- <5 minutes to explain any flagged asset

### 4. API & Integration Enhancements üîå **PLATFORM COORDINATED**

**Note:** Coordinate with AOS platform team to avoid duplication

#### 4.1 Microservice API v2
- [ ] GraphQL endpoint for flexible queries
- [ ] WebSocket/SSE for real-time updates
- [ ] Improved pagination and filtering
- [ ] Rate limiting per tenant

#### 4.2 Event Streaming
- [ ] Publish asset state changes to platform event bus
- [ ] Subscribe to platform discovery triggers
- [ ] Webhook callbacks for async operations

#### 4.3 Platform Integration Hooks
- [ ] Standardized authentication via platform (defer to platform RBAC)
- [ ] Metrics export to platform observability stack
- [ ] Audit log forwarding to platform compliance system

**Success Criteria:**
- <100ms API response time (P95)
- Zero breaking changes for existing consumers
- Full platform event integration

---

## Priority Horizon: LATER
**Nice-to-haves and future innovations**

### 5. User Experience Enhancements üí´ **MICROSERVICE OWNED**

#### 5.1 Advanced Triage Workflows
- [ ] Bulk actions (select multiple assets)
- [ ] Saved filters and custom views
- [ ] Keyboard navigation shortcuts
- [ ] Triage assignment and SLA tracking

#### 5.2 Enhanced Visualizations
- [ ] Network graph view of asset relationships
- [ ] Timeline view of asset lifecycle
- [ ] Risk heatmaps by vendor/environment
- [ ] Interactive data exploration

#### 5.3 Mobile Experience
- [ ] Responsive design improvements
- [ ] Touch-optimized triage actions
- [ ] Progressive Web App (PWA) capabilities

**Success Criteria:**
- 50% reduction in time-to-triage
- 90% user satisfaction score
- Mobile usage >20% of traffic

### 6. Advanced Automation ü§ñ **DEFER TO PLATFORM**

**Note:** Workflow automation should be a platform-level capability

- [ ] Expose automation hooks for platform workflow engine
- [ ] Provide action templates for common patterns
- [ ] Support async job execution from platform orchestrator

---

## Platform vs Microservice Responsibilities

### ‚úÖ **Our Microservice Owns:**
- Asset discovery and classification logic
- ML models and training pipeline
- HITL triage queue management
- Discovery-specific API endpoints
- Asset state transitions and business logic
- Discovery dashboard and triage UI

### ‚ö†Ô∏è **Defer to AOS Platform:**
- **Authentication & Authorization** - Platform RBAC, SSO, MFA
- **Compliance & Security** - SOC 2, GDPR, HIPAA, encryption
- **Enterprise Integrations** - IdP, CASB, ticketing, SIEM
- **Workflow Automation** - Visual builders, orchestration
- **Monitoring & Observability** - APM, logging, alerting
- **API Gateway** - Rate limiting, authentication, routing
- **Multi-tenancy infrastructure** - Tenant management, billing

---

## Immediate Action Items (This Week)

### Must Do:
1. [ ] **Finalize Supabase migration plan** - Detailed schema, scripts, rollback strategy
2. [ ] **Set up Supabase project** - Create instance, configure access
3. [ ] **Test connection override** - Verify we can bypass Replit's Neon stickiness
4. [ ] **Create tenant seed data** - Prepare multi-tenant test scenarios

### Should Do:
5. [ ] **Document API contracts** - For platform integration points
6. [ ] **Performance baseline** - Current metrics before migration
7. [ ] **Create migration runbook** - Step-by-step procedures

### Could Do (If Time):
8. [ ] **Bulk triage prototype** - Quick win for user productivity
9. [ ] **Export to CSV** - Simple feature add
10. [ ] **Basic webhook support** - For event notifications

---

## Success Metrics (Overall)

### Technical Excellence
- **Performance:** P95 <2s, support 100+ concurrent users per tenant
- **Reliability:** 99.9% uptime, zero data loss
- **Accuracy:** F1 score >90%, false positive rate <10%
- **Scale:** Support 1000+ tenants, 1M+ assets

### Customer Value
- **Efficiency:** 50% reduction in triage time
- **Coverage:** 95% asset discovery rate
- **Trust:** <5 min to explain any decision
- **Adoption:** 80% of alerts actioned within SLA

### Platform Integration
- **API Latency:** <100ms for core operations
- **Event Delivery:** 99.9% reliability
- **Compatibility:** Zero breaking changes
- **Documentation:** 100% API coverage

---

## Risk Mitigation

| Risk | Impact | Mitigation Strategy |
|------|--------|-------------------|
| Supabase migration complexity | High | Incremental migration with rollback plan |
| Platform integration delays | Medium | Define clear API contracts early |
| Model performance degradation | Medium | A/B testing and shadow mode |
| Multi-tenant data leaks | High | Thorough RLS testing, security audit |
| Scope creep | Medium | Strict focus on discovery/classification |

---

## Architectural Principles

1. **Microservice Focus** - Do one thing exceptionally well (discovery & classification)
2. **Platform Alignment** - Leverage platform capabilities, don't duplicate
3. **API-First Design** - All features accessible via API
4. **Tenant Isolation** - Zero data leakage between tenants
5. **Observable by Default** - Metrics, logs, traces for everything
6. **Progressive Enhancement** - Core functionality works without fancy features

---

## Communication & Coordination

- **Weekly sync with AOS platform team** - Alignment on integration points
- **Customer feedback loops** - Regular input on priorities
- **Technical design reviews** - Architect approval for major changes
- **Migration status updates** - Daily during Supabase migration

---

## Conclusion

This roadmap positions AOS Discover v2 as a focused, high-value microservice within the larger AOS platform. By prioritizing Supabase migration and multi-tenancy first, we establish the foundation for enterprise scale. We then enhance our core discovery intelligence while leveraging platform capabilities for enterprise features.

**Next Step:** Begin Supabase migration planning immediately, with detailed technical design review by architect.