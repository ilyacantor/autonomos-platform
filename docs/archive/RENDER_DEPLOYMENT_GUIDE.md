# Render Deployment Guide for AutonomOS

## Prerequisites

1. **Render Account** - Sign up at https://render.com
2. **Upstash Redis** - Get a Redis URL from https://upstash.com (free tier available)
3. **API Keys** - Have your Gemini and Pinecone API keys ready

## Deployment Steps

### Step 1: Create a Web Service on Render

1. Go to https://dashboard.render.com
2. Click **"New +"** â†’ **"Web Service"**
3. Connect your GitHub repository or deploy from this Replit

### Step 2: Configure Build Settings

- **Name:** `autonomos-platform` (or your preferred name)
- **Runtime:** `Python 3`
- **Build Command:** `pip install -r requirements.txt`
- **Start Command:** `bash start.sh`
- **Plan:** `Starter` (or higher)

### Step 3: Add Environment Variables

Click **"Environment"** and add these variables:

#### Required Variables:

| Variable | Value | Notes |
|----------|-------|-------|
| `REDIS_URL` | `redis://default:***@upstash-url:6379` | **CRITICAL!** Get from Upstash Redis |
| `DATABASE_URL` | Auto-generated by Render PostgreSQL | Add PostgreSQL addon first |
| `SECRET_KEY` | Random string (e.g., `openssl rand -hex 32`) | For JWT tokens |
| `API_KEY` | Random string | For API authentication |
| `GEMINI_API_KEY` | Your Gemini API key | For AI features |
| `PINECONE_API_KEY` | Your Pinecone API key | For RAG features |
| `ALLOWED_WEB_ORIGIN` | `https://your-app.onrender.com` | Replace with your Render URL |
| `PORT` | `10000` | Render's default port |

#### Optional Variables:

| Variable | Value | Notes |
|----------|-------|-------|
| `SLACK_WEBHOOK_URL` | Your Slack webhook | For notifications |

### Step 4: Add PostgreSQL Database

1. In your Render service dashboard, click **"Environment"**
2. Scroll to **"Databases"** section
3. Click **"New Database"** â†’ **"PostgreSQL"**
4. Name it and create
5. Render will automatically set `DATABASE_URL` environment variable

### Step 5: Deploy

1. Click **"Manual Deploy"** or push to your repository
2. Watch the deployment logs for:
   ```
   âœ… Using external Redis from REDIS_URL
   ðŸš€ Initialized dev_mode = false (Prod Mode)
   ```
3. Wait 3-5 minutes for deployment to complete

### Step 6: Verify Deployment

1. Open your Render app URL: `https://your-app.onrender.com`
2. Register/login
3. Go to **Connections** page
4. Click **"Select All Sources & Agents"**
5. Graph should appear in ~2-3 seconds

## Troubleshooting

### No Graph Appears

**Symptom:** Connection fails or no graph displays

**Fix:**
1. Check Render logs for `Error connecting to localhost:6379`
2. If present, verify `REDIS_URL` is set correctly in Environment Variables
3. Redeploy after setting REDIS_URL

### Slow Connections (>10s)

**Symptom:** Graph takes forever to load

**Fix:**
1. Check logs for `dev_mode = true`
2. System should auto-detect production and use `dev_mode = false`
3. Verify REDIS_URL is set (this triggers Prod Mode)

### Database Errors

**Symptom:** `relation "users" does not exist`

**Fix:**
1. Ensure PostgreSQL addon is connected
2. Check `DATABASE_URL` is set
3. App should auto-create tables on first run

### CORS Errors

**Symptom:** Browser shows "CORS policy" errors

**Fix:**
1. Set `ALLOWED_WEB_ORIGIN` to your Render URL
2. Format: `https://your-app.onrender.com` (no trailing slash)
3. Redeploy

## Performance Notes

- **Prod Mode:** Connections complete in ~2.4 seconds (heuristic-only)
- **Dev Mode:** Connections take ~67 seconds (AI/RAG enabled) - NOT recommended for production
- The system automatically detects production when REDIS_URL is set and uses Prod Mode

## Support

If you encounter issues:
1. Check Render deployment logs
2. Verify all environment variables are set
3. Ensure Upstash Redis is accessible (test the connection string)
4. Check that PostgreSQL addon is connected

## Key Differences from Replit Deployment

- **Redis:** Must use external Redis (Upstash) - no local Redis on Render
- **Port:** Render uses PORT=10000 by default (auto-set)
- **PostgreSQL:** Add as Render addon, not built-in like Replit
- **Secrets:** Set in Render Environment Variables, not Replit Secrets
